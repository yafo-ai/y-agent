import{l as ie,r as _,aR as Ue,z as f,B as o,R as l,O as r,L as k,u as i,P as y,K as L,J as a,al as m,ar as J,Q as P,aS as De,n as Ee,A as u,E as de,D as I,W as Q,I as re,a6 as ue}from"./vue-CdYMfVVj.js";import{_ as je,c as qe,u as Be,d as Ie,aD as Me,aE as He,aF as Ne,aG as Ae,i as Oe,aH as Fe,Q as Ke,aI as Le,aJ as Je,aK as Pe}from"./index-B6WbZO8q.js";import{b as Qe,r as Ge}from"./result-CcYZ99eM.js";import{a as ce}from"./comp-ClzPtuSi.js";import{C as We}from"./changeTree-DT6Je88Y.js";import{i as pe}from"./ioinput-6Hhi5G6f.js";import"./element-GwJlJi_X.js";import"./editor-Dhn2M38E.js";const Xe={class:"pagelistbox"},Ye={class:"c-titlebox"},Ze={class:"title"},et={key:0,style:{"font-size":"18px",color:"#999"}},tt={class:"c-bodybox"},lt={class:"catebox leftbox"},ot={class:"topbtns"},at={class:"treebox contain"},nt={class:"el-tree el-tree--highlight-current",role:"tree",style:{width:"100%"}},st={class:"el-tree-node__content",style:{"padding-left":"0px"}},it=["onClick","title"],dt={class:"item"},rt={class:"ellipsis"},ut={class:"btns"},ct=["onClick"],pt=["onClick"],_t=["onClick"],ft={class:"botbtns"},mt={class:"c-tablebox tableboxContain c-tooltip rightbox"},vt={style:{"margin-left":"24px","margin-right":"24px"},class:"c-top-searchbox c-js-item"},gt={class:"rbox"},bt={class:"btnbox tl c-js-item"},ht={class:"btns"},yt={class:"bodybox c-js-body"},wt={class:"contain"},kt={class:"dotbox"},xt={class:"dotcontentbox c-scroll-contain"},Ct={key:0,class:"title"},Vt={key:1,class:"items"},$t={class:"item ellipsis"},zt={class:"c-color-aaa c-pointer"},St={class:"flex"},Rt={class:"ellipsis2"},Tt={style:{margin:"0 -20px"}},Ut=["innerHTML"],Dt={key:0,class:"c-success-btn"},Et={key:1,class:"c-plain-btn"},jt={key:0,class:"c-success-btn"},qt={key:1,class:"c-plain-btn"},Bt=["onClick"],It=["onClick"],Mt=["onClick"],Ht={class:"c-emptybox"},Nt={key:0,class:"c-pagination"},At={class:"dialog-footer"},Ot={__name:"list",setup(Ft){const M=Ue(),_e=De(),x=Be();let n=ie({page:1,pagesize:30,id:void 0,cate_id:void 0,is_marked:void 0,is_modified:void 0,input_data:"",output_data:"",feature:""});const S=_(0),fe=()=>{n.id=void 0,n.is_marked=void 0,n.is_modified=void 0,n.input_data="",n.output_data="",n.feature=""};qe(n,M.query,"cate_id,id");let H=_([]),R="id";const v=s=>{if(s=="init"&&(n.page=1),n.id=n.id||void 0,Me(n).then(e=>{let d=e.rows||[],g=[];d.forEach(b=>{b[R]&&g.push(b[R])}),g.length>0?He({ids:g}).then(b=>{me(b.rows||[],d)}):H.value=d,S.value=e.total_records}),s!="noquery"){let e={...M.query,...n};_e.replace({path:M.path,query:e})}},me=(s,e)=>{e.forEach(d=>{if(d[R]){let g=[];s.forEach(b=>{b.train_case_id==d[R]&&g.push(b)}),d.test_cates=g}}),H.value=e};v(),_(null);const G=_(null),N=_([]),T=async s=>{n.cate_id=s.id,v("init")},A=s=>{Ne().then(async e=>{N.value=e||[],await Ee(),G.value.setCurrentKey(parseInt(n.cate_id))})};A();const C=_(!1),p=ie({name:"",color:"",id:void 0,pid:null});_();function W(){return("#"+Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")).toUpperCase()}const O=_(),F=async(s,e)=>{p.pid=s.pid||null,p.id=s.id||void 0,p.name=s.name||"",p.color=s.color||W(),e=="child"&&(p.pid=s.id,p.name="",p.id=void 0,p.color=W()),C.value=!0,setTimeout(()=>{O.value.focus()},400)},ve=s=>{_this.$confirm("确定要删除所选数据?").then(e=>{Le({id:s.id}).then(d=>{_this.$message("删除成功"),v()})})},ge=s=>{_this.$confirm("确定要删除所选数据?").then(e=>{Fe({id:s.id}).then(d=>{_this.$message("删除成功"),A()})})},U=_({id:0,train_cate_id:0,input_data:"",output_data:""}),D=_(!1),X=async s=>{U.value={...s,is_marked:!!s.is_marked,is_modified:!!s.is_modified},D.value=!0},be=async s=>{_this.$message("修改成功"),D.value=!1,v()},he=()=>{if(!p.color)return _this.$message("请选择分类颜色","error"),!1;if(!p.name)return O.value.focus(),!1;Je(p).then(s=>{_this.$message("操作成功"),C.value=!1,A()})},ye=()=>{if(n.cate_id===void 0||n.cate_id===null||n.cate_id==="")return _this.$message("请先选择分类","error"),!1;Ae({cate_id:n.cate_id})},Y=_({}),K=_(!1),we=async s=>{Ke({page:1,pagesize:1,flow_id:s}).then(d=>{let g=d.rows||[];Y.value=g[0]||{},K.value=!0})},Z=_(null),E=_(!1),ke=s=>{Pe({source_cate_id:s.curcateData.id,target_cate_id:s.curcateData1.id}).then(e=>{_this.$message("操作成功"),E.value=!1,v()})},ee=s=>(x.commit("loading",!0),!0),te=s=>{let e=s.toString();e=e.replace("UploadAjaxError: ",""),e=JSON.parse(e),_this.$message(e.detail,"error"),x.commit("loading",!1),v()},j=_(null),le=(s,e,d)=>{_this.$message("导入成功"),j.value&&j.value.clearFiles(),x.commit("loading",!1),v()},V=_(null),q=_(0);return(s,e)=>{const d=m("el-button"),g=m("el-tree"),b=m("el-scrollbar"),$=m("el-input"),w=m("el-form-item"),B=m("el-option"),oe=m("el-select"),ae=m("el-form"),ne=m("el-upload"),xe=m("el-link"),se=m("el-popover"),h=m("el-table-column"),Ce=m("el-table"),Ve=m("el-pagination"),$e=m("el-color-picker"),ze=m("el-dialog"),Se=J("searchOpen"),Re=J("copy"),Te=J("initTableHeight");return u(),f(P,null,[o("div",Xe,[o("div",Ye,[o("span",Ze,[e[26]||(e[26]=r("语料 ")),i(n).cate_id!==void 0?(u(),f("span",et," [id:"+y(i(n).cate_id)+"]",1)):k("",!0)])]),o("div",tt,[o("div",lt,[o("div",ot,[e[28]||(e[28]=o("span",{class:"title"},"语料类型",-1)),l(d,{onClick:e[0]||(e[0]=t=>T({id:void 0})),class:"on noradius",plain:""},{default:a(()=>e[27]||(e[27]=[o("span",{class:"iconfont icon-anniu-zhankai"},null,-1),r(" 查看全部 ")])),_:1})]),o("div",at,[l(b,null,{default:a(()=>[o("div",nt,[o("div",{class:de(["el-tree-node",{"is-current":i(n).cate_id==0}])},[o("div",st,[o("div",{onClick:e[1]||(e[1]=t=>T({id:0})),style:{"padding-left":"35px"},class:"custom-tree-node"},e[29]||(e[29]=[o("div",{class:"item"},[o("span",{class:"c-color",style:"background-color:#ff0000"}),r("未分类 ")],-1)]))])],2)]),l(g,{ref_key:"treeSelect",ref:G,style:{width:"100%"},data:N.value,"node-key":"id","empty-text":"暂无语料类目信息","highlight-current":"","current-node-key":i(n).cate_id?parseInt(i(n).cate_id):void 0,"default-expand-all":"",onNodeClick:T,"expand-on-click-node":!1},{default:a(({node:t,data:c})=>[o("div",{onClick:z=>T(c),title:c.name,class:"custom-tree-node"},[o("div",dt,[o("span",{class:"c-color",style:I("background-color:"+c.color)},null,4),o("p",rt,y(c.name),1)]),o("div",ut,[o("span",{title:"添加子类目",onClick:Q(z=>F(c,"child"),["stop"]),class:"iconfont icon-shuzhuang-tianjia"},null,8,ct),o("span",{title:"修改",onClick:Q(z=>F(c),["stop"]),class:"iconfont icon-xiugai"},null,8,pt),o("span",{title:"删除类目",onClick:Q(z=>ge(c),["stop"]),class:"iconfont icon-shuzhuang-shanchu"},null,8,_t)])],8,it)]),_:1},8,["data","current-node-key"])]),_:1})]),o("div",ft,[l(d,{style:{width:"100%"},plain:"",class:"on noradius",onClick:e[2]||(e[2]=t=>F({name:"",color:"",id:void 0,pid:null}))},{default:a(()=>e[30]||(e[30]=[o("span",{class:"iconfont icon-liebiao-xinzeng"},null,-1),r(" 新增分类")])),_:1})])]),L((u(),f("div",mt,[o("div",vt,[l(ae,{model:i(n),ref:"searchFormRef",inline:"",class:"demo-form-inline"},{default:a(()=>[l(w,{style:{width:"210px"},label:"id",prop:"id"},{default:a(()=>[l($,{modelValue:i(n).id,"onUpdate:modelValue":e[3]||(e[3]=t=>i(n).id=t),type:"text"},null,8,["modelValue"])]),_:1}),l(w,{style:{width:"210px"},label:"输入",prop:"input_data"},{default:a(()=>[l($,{modelValue:i(n).input_data,"onUpdate:modelValue":e[4]||(e[4]=t=>i(n).input_data=t),type:"text"},null,8,["modelValue"])]),_:1}),l(w,{style:{width:"210px"},label:"输出",prop:"output_data"},{default:a(()=>[l($,{modelValue:i(n).output_data,"onUpdate:modelValue":e[5]||(e[5]=t=>i(n).output_data=t),type:"text"},null,8,["modelValue"])]),_:1}),l(w,{style:{width:"210px"},label:"特征概要",prop:"feature"},{default:a(()=>[l($,{modelValue:i(n).feature,"onUpdate:modelValue":e[6]||(e[6]=t=>i(n).feature=t),type:"text"},null,8,["modelValue"])]),_:1}),l(w,{style:{width:"210px"},label:"是否审核",prop:"is_marked"},{default:a(()=>[l(oe,{clearable:"",modelValue:i(n).is_marked,"onUpdate:modelValue":e[7]||(e[7]=t=>i(n).is_marked=t),placeholder:"请选择"},{default:a(()=>[l(B,{label:"未审核",value:!1}),l(B,{label:"已审核",value:!0})]),_:1},8,["modelValue"])]),_:1}),l(w,{style:{width:"210px"},label:"是否更正",prop:"is_modified"},{default:a(()=>[l(oe,{clearable:"",modelValue:i(n).is_modified,"onUpdate:modelValue":e[8]||(e[8]=t=>i(n).is_modified=t),placeholder:"请选择"},{default:a(()=>[l(B,{label:"未更正",value:!1}),l(B,{label:"已更正",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),o("div",gt,[L((u(),f("span",{onClick:e[9]||(e[9]=t=>{q.value==0?q.value=67:q.value=0,V.value&&V.value.update()}),class:"c-search-openbtn"},e[31]||(e[31]=[o("span",{class:"iconfont icon-anniu-zhankai"},null,-1),o("span",{class:"opentext"},"展开",-1),o("span",{class:"closetext"},"收起",-1)]))),[[Se]]),l(d,{onClick:e[10]||(e[10]=t=>v("init")),type:"primary"},{default:a(()=>e[32]||(e[32]=[r("查询")])),_:1}),l(d,{onClick:e[11]||(e[11]=t=>fe()),plain:""},{default:a(()=>e[33]||(e[33]=[r("重置")])),_:1})])]),o("div",bt,[o("div",ht,[l(d,{onClick:e[12]||(e[12]=t=>X({id:null,is_marked:void 0,is_modified:void 0,train_cate_id:null,input_data:"",output_data:""})),type:"primary"},{default:a(()=>e[34]||(e[34]=[r("新增")])),_:1}),l(d,{onClick:e[13]||(e[13]=t=>E.value=!0),plain:""},{default:a(()=>e[35]||(e[35]=[r("调整类目")])),_:1}),l(ne,{class:"upload-demo",style:{margin:"0 12px"},ref_key:"uploadRef",ref:j,headers:{authorization:"Bearer "+i(x).state.token},"before-upload":ee,"show-file-list":!1,"on-error":te,"on-success":le,limit:1,action:"/api/train/case/import"},{default:a(()=>[l(d,{plain:""},{default:a(()=>e[36]||(e[36]=[r("批量导入")])),_:1})]),_:1},8,["headers"]),l(d,{onClick:e[14]||(e[14]=t=>ye()),plain:""},{default:a(()=>e[37]||(e[37]=[r("导出")])),_:1}),l(ne,{class:"upload-demo",style:{margin:"0 12px 0 12px"},ref_key:"uploadRef",ref:j,headers:{authorization:"Bearer "+i(x).state.token},"before-upload":ee,"show-file-list":!1,"on-error":te,"on-success":le,limit:1,action:"/api/train/case/import_update"},{default:a(()=>[l(d,{plain:""},{default:a(()=>e[38]||(e[38]=[r("批量修改")])),_:1})]),_:1},8,["headers"])]),l(xe,{onClick:e[15]||(e[15]=t=>i(Ie)("/api/train/download/case_template"))},{default:a(()=>e[39]||(e[39]=[o("span",{class:"iconfont icon-anniu-xiazai"},null,-1),r("下载导入模板")])),_:1})]),o("div",yt,[o("div",wt,[l(Ce,{ref_key:"tableRef",ref:V,"tooltip-effect":"light","max-height":i(x).getters.innerHeight-292-q.value,border:"",data:i(H),style:{width:"100%"}},{empty:a(t=>[o("div",Ht,[l(Oe,{type:"empzwssjg",width:"100",height:"100"}),e[43]||(e[43]=r("暂无数据~~ "))])]),default:a(()=>[l(h,{width:"100",prop:"id",label:"id"},{default:a(t=>[t.row.test_cates&&t.row.test_cates.length>0?(u(),re(se,{key:0,placement:"top-start",width:200,trigger:"hover"},{reference:a(()=>[o("div",kt,[(u(!0),f(P,null,ue(t.row.test_cates,(c,z)=>(u(),f("span",{class:de(["dot",{on:c.xl}]),style:I("background-color: "+c.case_cate_color+"; left: "+z*5+"px")},null,6))),256))])]),default:a(()=>[o("div",xt,[t.row.test_cates&&t.row.test_cates.length>0?(u(),f("div",Ct," 单元测试 ")):k("",!0),t.row.test_cates&&t.row.test_cates.length>0?(u(),f("div",Vt,[(u(!0),f(P,null,ue(t.row.test_cates,c=>(u(),f("div",$t,[o("span",{class:"c-color radius",style:I("background-color:"+c.case_cate_color)},null,4),L((u(),f("span",zt,[r("id: "+y(c.case_id),1)])),[[Re,c.case_id]]),r("  "+y(c.case_cate_name),1)]))),256))])):k("",!0)])]),_:2},1024)):k("",!0),r(" "+y(t.row.id),1)]),_:1}),l(h,{label:"类型",width:"160"},{default:a(t=>[o("div",St,[o("span",{class:"c-color",style:I("background-color: "+t.row.train_cate_color)},null,4),r(y(t.row.train_cate_name),1)])]),_:1}),l(h,{"min-width":"160",label:"输入"},{default:a(t=>[l(pe,{input:t.row.input_data,output:t.row.output_data},null,8,["input","output"])]),_:1}),l(h,{width:"160",label:"输出"},{default:a(t=>[l(pe,{isShowOutput:!0,input:t.row.input_data,output:t.row.output_data},null,8,["input","output"])]),_:1}),l(h,{"min-width":"160",label:"特征概要"},{default:a(t=>[t.row.feature?(u(),re(se,{key:0,placement:"top-start",width:500,trigger:"hover"},{reference:a(()=>[o("div",Rt,y(t.row.feature),1)]),default:a(()=>[o("div",Tt,[l(b,{"max-height":"400"},{default:a(()=>[o("div",{innerHTML:t.row.feature.replace(/\n/g,"<br>"),style:{margin:"0 20px"}},null,8,Ut)]),_:2},1024)])]),_:2},1024)):k("",!0)]),_:1}),l(h,{width:"100",label:"是否审核"},{default:a(t=>[t.row.is_marked?(u(),f("span",Dt,"已审核")):(u(),f("span",Et,"未审核"))]),_:1}),l(h,{width:"100",label:"是否更正"},{default:a(t=>[t.row.is_modified?(u(),f("span",jt,"已更正")):(u(),f("span",qt,"未更正"))]),_:1}),l(h,{width:"160",label:"创建时间"},{default:a(t=>[r(y(i(ce)(t.row.created_at)),1)]),_:1}),l(h,{width:"160",align:"center",label:"修改时间"},{default:a(t=>[r(y(i(ce)(t.row.updated_at)),1)]),_:1}),l(h,{width:"180",fixed:"right",align:"right",label:"操作"},{default:a(t=>[o("div",{onClick:c=>X(t.row),class:"c-table-ibtn"},e[40]||(e[40]=[o("span",{class:"iconfont icon-xiugai"},null,-1),r(" 修改 ")]),8,Bt),t.row.workflow_log_id?(u(),f("div",{key:0,onClick:c=>{Z.value=t.row.workflow_node_log_id,we(t.row.workflow_log_id)},class:"c-table-ibtn"},e[41]||(e[41]=[o("span",{class:"iconfont icon-liebiao-xiangqing"},null,-1),r(" 用例详情 ")]),8,It)):k("",!0),o("div",{onClick:c=>ve(t.row),class:"c-table-ibtn c-btn-del"},e[42]||(e[42]=[o("span",{class:"iconfont icon-shuzhuang-shanchu"},null,-1),r(" 删除 ")]),8,Mt)]),_:1})]),_:1},8,["max-height","data"]),S.value>0?(u(),f("div",Nt,[l(Ve,{"hide-on-single-page":!1,background:"","page-size":i(n).pagesize,"current-page":i(n).page,onSizeChange:e[16]||(e[16]=t=>{i(n).pagesize=t,i(n).page=Math.min(Math.ceil(S.value/i(n).pagesize),i(n).page),v()}),onCurrentChange:e[17]||(e[17]=t=>{i(n).page=t,V.value&&V.value.scrollTo(0,0),v()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:S.value},null,8,["page-size","current-page","total"])])):k("",!0)])])])),[[Te]])])]),l(ze,{"align-center":"",modelValue:C.value,"onUpdate:modelValue":e[22]||(e[22]=t=>C.value=t),title:p.id?"修改分类":"新增分类",width:"500"},{footer:a(()=>[o("div",At,[l(d,{plain:"",onClick:e[20]||(e[20]=t=>C.value=!1)},{default:a(()=>e[44]||(e[44]=[r(" 取消 ")])),_:1}),l(d,{type:"primary",onClick:e[21]||(e[21]=t=>he())},{default:a(()=>e[45]||(e[45]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ae,{ref:"formRef",model:p,"label-width":"auto","label-position":"top",class:"demo-dynamic tl"},{default:a(()=>[l(w,{prop:"name",label:"分类名称",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},{default:a(()=>[l($,{modelValue:p.name,"onUpdate:modelValue":e[18]||(e[18]=t=>p.name=t),ref_key:"inputRef",ref:O,style:{width:"calc(100% - 42px)","margin-right":"10px"},placeholder:"分类名称"},null,8,["modelValue"]),l($e,{modelValue:p.color,"onUpdate:modelValue":e[19]||(e[19]=t=>p.color=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Qe,{modelValue:D.value,"onUpdate:modelValue":e[23]||(e[23]=t=>D.value=t),item:U.value,curResult:U.value,title:U.value.id?"修改语料数据":"新增语料数据",onSubfn:be},null,8,["modelValue","item","curResult","title"]),l(Ge,{modelValue:K.value,"onUpdate:modelValue":e[24]||(e[24]=t=>K.value=t),nodeid:Z.value,data:Y.value},null,8,["modelValue","nodeid","data"]),l(We,{dataSource:N.value,modelValue:E.value,"onUpdate:modelValue":e[25]||(e[25]=t=>E.value=t),onSubfn:ke},null,8,["dataSource","modelValue"])],64)}}},Yt=je(Ot,[["__scopeId","data-v-a99ee207"]]);export{Yt as default};
