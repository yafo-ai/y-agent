import{aR as ge,aS as be,r as d,h as qe,j as pe,al as g,I as Z,A as f,J as s,C as Ae,R as o,a4 as Te,W as ye,B as l,O as m,l as oe,c as Be,z as k,L as q,u as v,D as ne,Q as P,a6 as $e,E as Ue,P as L,K as he,S as we,n as Se}from"./vue-CdYMfVVj.js";import{u as Ve,_ as De,aV as Ee,E as Re,i as Le,af as Me,aW as Fe,aX as Ke,aY as He,aZ as Ne,a_ as Pe,a$ as We,b0 as Xe,b1 as Ge,V as Je,aR as Oe,b2 as ze,b3 as Ze,b4 as Qe,b5 as Ye,b6 as et,b7 as tt}from"./index-B6WbZO8q.js";import{u as lt}from"./element-GwJlJi_X.js";import{C as nt}from"./list-BbxMWpnt.js";import{a as Ce,g as Ie}from"./comp-ClzPtuSi.js";/* empty css                                                              */import{C as ot}from"./changeTree-DT6Je88Y.js";import{x as st}from"./xltest-sIMEY9zz.js";import"./editor.api-_A1huWdg.js";import"./list.vue_vue_type_style_index_1_lang-B8pmpZgU.js";import"./editor-Dhn2M38E.js";const at={class:"dialog-footer"},it={__name:"add",props:{id:{type:[String,Number],default:()=>0},title:{type:[String,Number],default:"请输入文件夹名称"},name:{type:[String,Number],default:()=>""},maxlength:{type:[String,Number],default:()=>30},caption:{type:[String,Number],default:()=>""},modelValue:{type:Boolean,default:()=>!1}},emits:["subfn","update:modelValue"],setup(se,{emit:a}){const C=se,M=a;ge(),be(),Ve();const z=d(!1),x=d(""),r=d("");qe(()=>{z.value=C.modelValue,x.value=C.name,r.value=C.caption,y()}),pe(()=>C.name,c=>{x.value=c});const V=d(C.maxlength);pe(()=>C.maxlength,c=>{V.value=c}),pe(()=>C.caption,c=>{r.value=c}),pe(()=>C.modelValue,c=>{z.value=c});const A=()=>{M("update:modelValue",!1)},h=()=>{if(x.value=="")return y(),!1;M("subfn",{name:x.value,caption:r.value})},y=()=>{setTimeout(()=>{document.querySelectorAll(".c-focus-inp input")[0]&&document.querySelectorAll(".c-focus-inp input")[0].focus()},100)};return(c,b)=>{const D=g("el-input"),W=g("el-form-item"),F=g("el-form"),w=g("el-button"),E=g("el-dialog");return f(),Z(E,{"align-center":"",modelValue:z.value,"onUpdate:modelValue":b[5]||(b[5]=j=>z.value=j),title:se.title,onClosed:A,width:"500"},{footer:s(()=>[l("div",at,[o(w,{onClick:b[3]||(b[3]=j=>A())},{default:s(()=>b[6]||(b[6]=[m("取消")])),_:1}),o(w,{type:"primary",onClick:b[4]||(b[4]=j=>h(x.value))},{default:s(()=>b[7]||(b[7]=[m(" 确定提交 ")])),_:1})])]),default:s(()=>[Ae(c.$slots,"default"),o(F,{onSubmit:b[1]||(b[1]=ye(()=>{},["prevent"])),"label-width":"100",onKeyup:b[2]||(b[2]=Te(j=>h(x.value),["native","enter"])),ref:"ruleFormRef"},{default:s(()=>[o(W,{label:"名称"},{default:s(()=>[o(D,{class:"c-focus-inp",modelValue:x.value,"onUpdate:modelValue":b[0]||(b[0]=j=>x.value=j),maxlength:V.value,autocomplete:"off"},null,8,["modelValue","maxlength"])]),_:1})]),_:1},512)]),_:3},8,["modelValue","title"])}}},dt={class:"page-wbsj"},ut={class:"mg20"},rt={class:"tl backbox"},ct={key:0,class:"groupbtns"},pt={key:1,class:"groupbtns"},mt={key:0,style:{"margin-top":"20px"},class:"mdbox"},vt={key:0,class:"historybox c-history"},ft={key:0,class:"empty"},_t=["onClick"],yt=["title"],gt={style:{"margin-left":"5px"},class:"c-warn-btn c-mini radius"},bt={class:"timebox"},kt={class:"time"},xt={class:"mdeditor"},ht={key:0,class:"namebox re"},wt={class:"mdcontain"},$t={class:"uploadbox"},Ct={class:"tablebox c-tablebox"},qt={style:{display:"flex","align-items":"center"}},Vt={style:{"margin-left":"10px"}},Dt={style:{display:"flex","align-items":"center"}},St={style:{"margin-left":"10px"}},zt={class:"c-emptybox"},It={style:{padding:"20px 0 0 0"}},Ut={key:0},Lt={key:1,class:"placeholder"},Mt={class:"dialog-footer"},jt={key:0,class:"c-footerbtns",style:{bottom:"-20px","justify-content":"flex-end"}},At={__name:"wbsj",props:{id:{type:[String,Number],default:()=>0}},setup(se){const a=ge(),C=be(),M=Ve(),z=d(!0);qe(async()=>{});const x=d(a.query.did),r=d(1),V=d([]),A=(p,e)=>{V.value=e},h=d(null),y=d(""),c=d(!1),b=d(""),D=d(""),W=p=>{let e={...a.query};e.it=2,e.did=p,C.replace({path:a.path,query:e})},F=d(""),w=p=>{Me({id:x.value}).then(e=>{h.value=e,b.value=e.name,D.value=e.name,e.is_markdown?(y.value=e.markdown_content,F.value=e.markdown_content):(y.value=e.content,F.value=e.content),c.value=e.is_markdown})};a.query.it==2&&w();const E=p=>(M.commit("loading",!0),/\.(xlsx|xls|xlsm|txt)$/i.test(p.name),!0),j=p=>p<30?"#909399":p<70?"#e6a23c":"#67c23a",X=()=>{let p={...a.query};p.it=0,C.replace({path:a.path,query:p})};let me="/api/documents/add?knowledgebase_id="+a.query.id;a.query.category_id&&(me+="&category_id="+a.query.category_id);const Q=d(me),Y=(p,e,$)=>{M.commit("loading",!1),console.log(p,e,$)},ke=p=>{M.commit("loading",!1);let e=p.toString();e=e.replace("UploadAjaxError: ",""),e=JSON.parse(e),_this.$message(e.detail,"error")},ae=(p,e)=>{if(z.value=!1,b.value.length==0||y.value.length==0)return _this.$message("文档名称、内容不可为空","error"),!1;Ke({id:x.value,text:y.value,name:b.value,is_markdown:c.value},e).then($=>{_this.$message("保存成功"),X()})},ve=d(0),ee=p=>{ve.value=p.ver,Fe({ver:p.ver,id:x.value}).then(e=>{y.value=e.content,c.value=e.is_markdown})},U=oe({text:"",name:"",region:"",llm_type:1});oe({link:"",name:""});const S=oe({text:"",name:"",checkList:[],llm_type:1}),G=d(!1),fe=async()=>{let p=null;S.checkList.length>0&&(p=S.checkList[0].id),He({id:x.value,llm_id:S.llm_type,prompt_id:p,content:y.value}).then(e=>{e.result=="success"&&(G.value=!1,_this.$message("整理成功"),y.value=e.content)})},K=d(!1);d([]),d([]);const R=d(!1),xe=()=>{if(U.name.length==0||U.text.length==0)return _this.$message("文档名称、内容不可为空","error"),!1;if(K.value)return!1;K.value=!0,Ne({knowledgebase_id:parseInt(a.query.id),category_id:parseInt(a.query.category_id)||0,name:U.name,content:U.text}).then(p=>{x.value=p.id,W(p.id),w()}).finally(()=>{K.value=!1})},H=d(!1),J=d([]);a.query.it==2&&Ee({id:x.value}).then(p=>{J.value=p||[]});const ie=p=>{c.value=p,p?y.value=h.value.markdown_content:y.value=h.value.content},de=d([]);Re({page:1,pagesize:1e4}).then(p=>{de.value=p||[]});const ue=(p,e,$)=>{Pe({file:$[0]}).then(te=>{e({url:te.file_path,desc:""})}).catch(te=>{})},T=Be(()=>{const p=a.query.it==2||H.value,e=a.query.it==1&&!H.value&&r.value==2;return p||e});return(p,e)=>{const $=g("el-button"),te=g("el-scrollbar"),n=g("el-input"),t=g("v-md-editor"),_=g("el-icon"),O=g("el-upload"),B=g("el-table-column"),re=g("el-progress"),N=g("el-table"),le=g("el-form-item"),_e=g("el-form"),u=g("el-option"),I=g("el-select"),ce=g("el-dialog"),je=g("el-drawer");return f(),k("div",dt,[l("div",ut,[l("div",rt,[v(a).query.it==1&&!H.value?(f(),k("div",ct,[o($,{plain:"",style:ne(r.value==1?"background:none;":"background:#fff;"),onClick:e[0]||(e[0]=i=>r.value=2)},{default:s(()=>e[22]||(e[22]=[m("手工录入")])),_:1},8,["style"]),o($,{plain:"",style:ne(r.value==2?"background:none;":"background:#fff;"),onClick:e[1]||(e[1]=i=>r.value=1)},{default:s(()=>e[23]||(e[23]=[m("上传文档")])),_:1},8,["style"])])):q("",!0),v(a).query.it==2?(f(),k("div",pt,[o($,{type:"primary",style:ne(c.value?"background:none;":"background:#fff;"),plain:"",onClick:e[2]||(e[2]=i=>ie(!c.value))},{default:s(()=>e[24]||(e[24]=[m("编辑源文档")])),_:1},8,["style"]),o($,{style:ne(c.value?"background:#fff;":"background:none;"),plain:"",onClick:e[3]||(e[3]=i=>ie(!c.value))},{default:s(()=>e[25]||(e[25]=[m("编辑markdown文档")])),_:1},8,["style"])])):q("",!0),l("span",{style:{float:"right"},onClick:e[4]||(e[4]=i=>X()),class:"c-iconbackbox"},e[26]||(e[26]=[l("span",{class:"iconfont icon-fuwenben-chexiao"},null,-1),m(" 返回 ")]))]),v(a).query.it==2||H.value?(f(),k("div",mt,[v(a).query.it==2?(f(),k("div",vt,[e[27]||(e[27]=l("div",{class:"title"},"历史记录",-1)),o(te,{style:{height:"calc(100% - 40px)"}},{default:s(()=>[J.value.length<1?(f(),k("div",ft,"暂无历史数据")):q("",!0),(f(!0),k(P,null,$e(J.value,i=>(f(),k("div",{onClick:zl=>ee(i),key:i.ver,class:Ue([{on:i.ver==ve.value},"item"])},[l("div",{title:i.name,class:"name ellipsis3"},[m(L(i.name),1),l("span",gt,L(i.ver),1)],8,yt),l("div",bt,[l("span",kt,L(v(Ce)(i.created_at)),1)])],10,_t))),128))]),_:1})])):q("",!0),l("div",xt,[v(a).query.it==2?(f(),k("div",ht,[e[29]||(e[29]=l("span",{class:"display:inline-block;width:86px;"},"文件名称：",-1)),o(n,{style:{width:"calc(100% - 86px)"},modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=i=>b.value=i),type:"text"},null,8,["modelValue"]),o($,{style:{position:"absolute",top:"0",right:"0","border-radius":"6px"},onClick:e[6]||(e[6]=i=>{G.value=!0}),type:"primary"},{default:s(()=>e[28]||(e[28]=[m("AI整理")])),_:1})])):q("",!0),l("div",wt,[o(t,{"disabled-menus":[],onUploadImage:ue,onSave:e[7]||(e[7]=i=>ae(y.value)),modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=i=>y.value=i),height:"100%"},null,8,["modelValue"])])])])):v(a).query.it==1?(f(),k(P,{key:1},[he(l("div",$t,[o(O,{class:"upload-demo","file-list":V.value,"onUpdate:fileList":e[9]||(e[9]=i=>V.value=i),headers:{authorization:"Bearer "+v(M).state.token},"before-upload":E,"on-change":A,"show-file-list":!1,"on-error":ke,"on-success":Y,drag:"",action:Q.value,multiple:""},{default:s(()=>[o(_,{class:"el-icon--upload"},{default:s(()=>[o(v(lt))]),_:1}),e[30]||(e[30]=l("div",{class:"el-upload__text"},[m(" 点击或拖动文件到此处上传 "),l("br"),l("div",{class:"tip"},[m(" 支持 .txt, .docx, .csv, .xlsx, .pdf, .md类型文件 "),l("br"),m("最多支持 15 个文件。单个文件最大 100 MB。 ")])],-1))]),_:1},8,["file-list","headers","action"])],512),[[we,r.value==1]]),he(l("div",Ct,[o(N,{data:V.value,"max-height":v(M).getters.innerHeight-500,style:{width:"100%"}},{empty:s(i=>[l("div",zt,[o(Le,{type:"empzwssjg",width:"100",height:"100"}),e[31]||(e[31]=m("暂无数据~~ "))])]),default:s(()=>[o(B,{label:"文件名"},{default:s(i=>[l("div",qt,[l("span",Vt,L(i.row.name),1)])]),_:1}),o(B,{label:"进度条"},{default:s(i=>[o(re,{percentage:i.row.status=="success"?i.row.percentage:Math.min(i.row.percentage,98),striped:"",color:j},null,8,["percentage"])]),_:1}),o(B,{label:"文件大小"},{default:s(i=>[l("div",Dt,[l("span",St,L(i.row.size),1)])]),_:1})]),_:1},8,["data","max-height"])],512),[[we,r.value==1&&V.value.length>0]]),he(l("div",It,[o(_e,{class:"tl",model:U,"label-width":"auto","label-position":"top",style:ne(J.value.length>0?"max-width: 800px":"100%")},{default:s(()=>[o(le,{label:"文档名称"},{default:s(()=>[o(n,{maxlength:"100",modelValue:U.name,"onUpdate:modelValue":e[10]||(e[10]=i=>U.name=i)},null,8,["modelValue"])]),_:1}),o(le,{label:"文档内容"},{default:s(()=>[o(n,{modelValue:U.text,"onUpdate:modelValue":e[11]||(e[11]=i=>U.text=i),rows:26,type:"textarea",placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","style"])],512),[[we,r.value==2]])],64)):q("",!0)]),o(ce,{"align-center":"",modelValue:G.value,"onUpdate:modelValue":e[16]||(e[16]=i=>G.value=i),title:"整理文档",width:"900"},{footer:s(()=>[l("div",Mt,[o($,{onClick:e[14]||(e[14]=i=>G.value=!1)},{default:s(()=>e[33]||(e[33]=[m("取消")])),_:1}),o($,{type:"primary",onClick:e[15]||(e[15]=i=>fe())},{default:s(()=>e[34]||(e[34]=[m(" 确定提交 ")])),_:1})])]),default:s(()=>[o(_e,{class:"tl",model:S,"label-width":"auto","label-position":"top",style:{width:"100%"}},{default:s(()=>[o(le,{label:"大模型类型"},{default:s(()=>[o(I,{modelValue:S.llm_type,"onUpdate:modelValue":e[12]||(e[12]=i=>S.llm_type=i),filterable:"","reserve-keyword":!1,placeholder:""},{default:s(()=>[(f(!0),k(P,null,$e(de.value,i=>(f(),Z(u,{value:parseInt(i.id,10),label:i.name},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(le,{label:"提示词"},{default:s(()=>[l("div",{onClick:e[13]||(e[13]=i=>R.value=!0),class:"c-switchbox pointer"},[S.checkList.length>0?(f(),k("span",Ut,L(S.checkList[0].name),1)):(f(),k("span",Lt,"请选择提示词")),e[32]||(e[32]=l("span",{style:{position:"absolute",top:"-36px",right:"0",color:"var(--el-color-primary)"},class:"c-pointer"},"选择",-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(je,{modelValue:R.value,"onUpdate:modelValue":e[18]||(e[18]=i=>R.value=i),size:"90%",title:"",direction:"rtl"},{default:s(()=>[o(nt,{onSubfn:e[17]||(e[17]=i=>{R.value=!1,S.checkList=i}),isCheck:!0,checkList:S.checkList},null,8,["checkList"])]),_:1},8,["modelValue"]),T.value?(f(),k("div",jt,[v(a).query.it==2||H.value?(f(),k(P,{key:0},[c.value?(f(),Z($,{key:0,onClick:e[19]||(e[19]=i=>ae(y.value,!0)),type:"primary"},{default:s(()=>e[35]||(e[35]=[m("保存并同步向量库")])),_:1})):q("",!0),o($,{onClick:e[20]||(e[20]=i=>ae(y.value)),plain:""},{default:s(()=>e[36]||(e[36]=[m("保存")])),_:1})],64)):q("",!0),v(a).query.it==1&&!H.value&&r.value==2?(f(),Z($,{key:1,onClick:e[21]||(e[21]=i=>xe()),loading:K.value,type:"primary"},{default:s(()=>e[37]||(e[37]=[m("保存")])),_:1},8,["loading"])):q("",!0)])):q("",!0)])}}},Tt=De(At,[["__scopeId","data-v-8b1db143"]]),Bt={class:"topbox"},Et={class:"pageContain"},Rt={class:"pagelistbox c-cardbox"},Ft=["onClick"],Kt={class:"top ellipsis"},Ht={class:"title ellipsis"},Nt={class:"intro ellipsis3"},Pt=["title"],Wt={class:"dialogbox"},Xt={class:"dialog-footer"},Gt={__name:"index",setup(se){const a=ge(),C=be();let M=d([]);const z=d(null);Me({id:a.query.did}).then(y=>{z.value=y,M.value=y.nodes});const x=()=>{let y={...a.query};y.it=0,C.replace({path:a.path,query:y})},r=d(!1),V=d(""),A=d(""),h=y=>{A.value=y.node_id,V.value=y.text,r.value=!0};return(y,c)=>{const b=g("el-scrollbar"),D=g("v-md-preview"),W=g("el-button"),F=g("el-dialog");return f(),k(P,null,[l("div",Bt,[c[4]||(c[4]=l("span",null,null,-1)),l("span",{onClick:c[0]||(c[0]=w=>x()),class:"c-iconbackbox"},c[3]||(c[3]=[l("span",{class:"iconfont icon-fuwenben-chexiao"},null,-1),m(" 返回 ")]))]),l("div",Et,[o(b,null,{default:s(()=>[l("div",Rt,[(f(!0),k(P,null,$e(v(M),(w,E)=>(f(),k("div",{key:w.node_id,onClick:j=>h(w),class:"item"},[l("div",Kt,L(z.value.category_name),1),l("div",Ht,L(w.node_id),1),l("div",Nt,[w.text?(f(),k("span",{key:0,title:w.text,class:"note"},L(w.text),9,Pt)):q("",!0)])],8,Ft))),128))])]),_:1})]),o(F,{"align-center":"",modelValue:r.value,"onUpdate:modelValue":c[2]||(c[2]=w=>r.value=w),title:A.value,width:"800"},{footer:s(()=>[l("div",Xt,[o(W,{onClick:c[1]||(c[1]=w=>r.value=!1)},{default:s(()=>c[5]||(c[5]=[m("关闭")])),_:1})])]),default:s(()=>[l("div",Wt,[o(b,null,{default:s(()=>[o(D,{text:V.value},null,8,["text"])]),_:1})])]),_:1},8,["modelValue","title"])],64)}}},Jt=De(Gt,[["__scopeId","data-v-42700152"]]),Ot={key:0,class:"dataset-detail"},Zt={class:"c-titlebox"},Qt={class:"title"},Yt={class:"btns"},el={class:"c-bodybox"},tl={class:"catebox leftbox"},ll={class:"topbtns"},nl={class:"treebox contain"},ol={class:"el-tree el-tree--highlight-current",role:"tree",style:{width:"100%"}},sl={class:"el-tree-node__content",style:{"padding-left":"0px"}},al=["onClick","title"],il={class:"ellipsis"},dl={class:"btns"},ul=["onClick"],rl=["onClick"],cl=["onClick"],pl={class:"botbtns"},ml={class:"tablebox rightbox"},vl={class:"c-top-searchbox searchbox"},fl={class:"lbox re"},_l={class:"rbox"},yl={class:"tableboxContain"},gl=["onClick"],bl=["onClick"],kl=["onClick"],xl={style:{display:"flex","align-items":"center"}},hl={key:0,title:"文档已修改，请更新向量库",class:"iconfont icon-gantanhao"},wl=["onClick"],$l=["onClick"],Cl=["onClick"],ql=["onClick"],Vl={class:"c-emptybox"},Dl={key:0,class:"c-pagination"},Sl={__name:"detail",setup(se){const a=ge(),C=be(),M=Ve(),z=d(null),x=d([]);let r=oe({knowledgebase_id:a.query.id,category_id:void 0,keyword:void 0,page:1,pagesize:30});qe(async()=>{We({id:a.query.id}).then(n=>{z.value=n,document.title=z.value.name}),r.knowledgebase_id=a.query.knowledgebase_id||void 0,r.keyword=a.query.keyword||void 0,r.category_id=a.query.category_id===void 0?void 0:parseInt(a.query.category_id),r.page=parseInt(a.query.page)||1,r.pagesize=parseInt(a.query.pagesize)||30,h("noquery"),E()}),pe(()=>a.query.it,(n,t)=>{n==0&&(t==1||t==2)&&h("noquery")},{immediate:!0,deep:!0});const V=d(0),A=d([]),h=n=>{if(n=="init"&&(r.page=1),r.knowledgebase_id=a.query.id,Xe(r).then(t=>{V.value=t.total_records,A.value=t.rows}),n!="noquery"){let t={...a.query,...r};C.replace({path:a.path,query:t})}},y=d(null),c=d(!1),b=d(null);d(null);const D=oe({id:"",name:"",caption:""}),W=n=>{b.value=n.pid,D.id=n.id,D.name=n.name,D.caption=n.caption,c.value=!0},F=n=>{_this.$confirm("确定要删除该类目吗？").then(()=>{Ze({id:n}).then(()=>{_this.$message("删除成功"),E()})})},w=n=>{b.value=n.id,D.id="",D.name="",D.caption="",c.value=!0},E=n=>{Ge({knowledgebase_id:a.query.id}).then(async t=>{x.value=t||[],await Se(),y.value.setCurrentKey(parseInt(r.category_id))}).catch(t=>{t.response&&t.response.data&&t.response.data.detail=="知识库类目不存在"&&(x.value=[])})},j=async n=>{let t={knowledgebase_id:a.query.id,p_id:b.value,id:D.id,...n};ze(t).then(_=>{_this.$message("提交成功"),E(),c.value=!1})};function X(n,t){for(let _=0;_<n.length;_++){if(n[_].id==t)return n[_];if(n[_].children&&n[_].children.length>0){let O=X(n[_].children,t);if(O)return O}}return null}const me=(n,t,_,O)=>{if(!(!n||!t)&&n.data.id!=t.data.id&&t.data.pid!=n.data.id){let B=X(x.value,n.data.id);if(B&&B.children&&B.children.length>0&&X(B.children,t.data.id))return!1;n.data.pid=t.data.id,ze({id:n.data.id,p_id:n.data.pid,name:n.data.name,knowledgebase_id:a.query.id,caption:""}).then(re=>{E()})}},Q=async n=>{r.keyword=void 0,r.category_id=n.id,x.value=[].concat(x.value),await Se(),y.value.setCurrentKey(parseInt(r.category_id)),h("init")},Y=(n,t)=>{let _={...a.query};_.it=n,_.did=t,C.replace({path:a.path,query:_})},ke=n=>{_this.$confirm("确定要删除该文档吗？").then(t=>{et({id:n}).then(_=>{_this.$message("删除成功"),h()})})},ae=n=>{_this.$confirm("确定要删除该向量库数据吗？").then(t=>{Ye({id:n}).then(_=>{_this.$message("删除成功"),h()})})},ve=n=>{Qe({id:n}).then(t=>{_this.$message("添加成功"),h()})};d(!1);const ee=d({}),U=d({}),S=d(""),G=d(""),fe=n=>{S.value="",K.value=null,n&&(K.value={...n},S.value=n.id,G.value=n.category_id?X(x.value,n.category_id).name:"未分类"),U.value={},ee.value={},R.value=!0},K=d(null),R=d(!1),xe=n=>{ee.value=n.curcateData,U.value=n.curcateData1,S.value=n.curDomid,H()},H=()=>{if(!U.value)return!1;let n={target_category_id:U.value.id};if(S.value)n.id=S.value;else{if(!ee.value)return!1;n.category_id=ee.value.id}if(!n.target_category_id)return!1;tt(n).then(t=>{_this.$message("提交成功"),R.value=!1,h()})},J=d([]),ie=d([]),de=d([]);Je().then(n=>{let t=n||[];J.value=[],ie.value=[],de.value=[],t.forEach(_=>{_.type==2?ie.value.push(_):_.type==1?J.value.push(_):_.type==3&&de.value.push(_)})});const ue=d(!1),T=oe({knowledgebase_k:5,knowledgebase_ids:[],file_knowledgebase_ids:[],product_model_ids:[],file_knowledgebase_k:5,product_model_top_k:5,question:""}),p=d([]),e=n=>{p.value=[],T.knowledgebase_k=5,T.knowledgebase_ids=[z.value.id],T.product_model_ids=[],T.file_knowledgebase_ids=[],T.product_model_top_k=5,T.file_knowledgebase_k=5,T.question="",ue.value=!0},$=d(null),te=()=>{let n={knowledgebase_id:a.query.id};Oe(n).then(t=>{t&&(_this.$message("批量更新向量库提交成功"),h("init"))})};return(n,t)=>{const _=g("el-button"),O=g("el-tree"),B=g("el-scrollbar"),re=g("el-input"),N=g("el-table-column"),le=g("el-table"),_e=g("el-pagination");return f(),k(P,null,[z.value?(f(),k("div",Ot,[l("div",Zt,[l("span",Qt,[l("span",{class:"c-pointer",style:{color:"#909BA5","margin-right":"5px"},onClick:t[0]||(t[0]=u=>v(Ie)(null,v(C),"/dataset/list?active=1"))},t[16]||(t[16]=[m(" 全部知识库 "),l("span",{class:"iconfont icon-xiangyoujiantou"},null,-1)])),m(" "+L(z.value.name),1)]),l("div",Yt,[o(_,{size:"small",onClick:t[1]||(t[1]=u=>fe()),plain:""},{default:s(()=>t[17]||(t[17]=[m("调整类目")])),_:1}),o(_,{size:"small",onClick:t[2]||(t[2]=u=>e()),plain:""},{default:s(()=>t[18]||(t[18]=[m("向量检测")])),_:1}),o(_,{size:"small",onClick:t[3]||(t[3]=u=>te()),plain:""},{default:s(()=>t[19]||(t[19]=[m("批量更新向量库")])),_:1})])]),l("div",el,[l("div",tl,[l("div",ll,[t[21]||(t[21]=l("span",{class:"title"},"文档类目",-1)),o(_,{onClick:t[4]||(t[4]=u=>Q({id:void 0})),class:"on noradius",plain:""},{default:s(()=>t[20]||(t[20]=[l("span",{class:"iconfont icon-anniu-zhankai"},null,-1),m(" 查看全部 ")])),_:1})]),l("div",nl,[o(B,null,{default:s(()=>[l("div",ol,[l("div",{class:Ue(["el-tree-node",{"is-current":v(r).category_id==0}])},[l("div",sl,[l("div",{title:"1",onClick:t[5]||(t[5]=u=>Q({id:0})),style:{"padding-left":"35px"},class:"custom-tree-node"},t[22]||(t[22]=[l("span",{class:"ellipsis"},"未分类",-1)]))])],2)]),o(O,{ref_key:"treeSelect",ref:y,style:{width:"100%"},data:x.value,draggable:"",onNodeDragEnd:me,"node-key":"id","empty-text":"暂无商品类目信息","highlight-current":"",onNodeClick:Q,"current-node-key":v(r).category_id?parseInt(v(r).category_id):void 0,"default-expand-all":"","expand-on-click-node":!1},{default:s(({node:u,data:I})=>[l("div",{onClick:ce=>Q(I),title:I.name,class:"custom-tree-node"},[l("span",il,L(I.name),1),l("div",dl,[l("span",{title:"添加子类目",onClick:ye(ce=>w(I),["stop"]),class:"iconfont icon-shuzhuang-tianjia"},null,8,ul),l("span",{title:"修改",onClick:ye(ce=>W(I),["stop"]),class:"iconfont icon-xiugai"},null,8,rl),l("span",{title:"删除类目",onClick:ye(ce=>F(I.id),["stop"]),class:"iconfont icon-shuzhuang-shanchu"},null,8,cl)])],8,al)]),_:1},8,["data","current-node-key"])]),_:1})]),l("div",pl,[o(_,{style:{width:"100%"},plain:"",class:"on noradius",onClick:t[6]||(t[6]=u=>w({id:null}))},{default:s(()=>t[23]||(t[23]=[l("span",{class:"iconfont icon-liebiao-xinzeng"},null,-1),m(" 新增类目")])),_:1})])]),l("div",ml,[v(a).query.it==3?(f(),Z(Jt,{key:0})):v(a).query.it==1||v(a).query.it==2?(f(),Z(Tt,{key:1})):(f(),k(P,{key:2},[l("div",vl,[l("div",fl,[o(_,{style:{"margin-right":"16px"},size:"small",onClick:t[7]||(t[7]=u=>Y(1)),type:"primary"},{default:s(()=>t[24]||(t[24]=[m("新建文档")])),_:1}),o(re,{style:{width:"300px"},modelValue:v(r).keyword,"onUpdate:modelValue":t[8]||(t[8]=u=>v(r).keyword=u),placeholder:"关键词查询",clearable:""},null,8,["modelValue"]),o(_,{style:{position:"absolute",right:"0",top:"0","border-radius":"var(--el-border-radius-base)"},onClick:t[9]||(t[9]=u=>h()),type:"primary"},{default:s(()=>t[25]||(t[25]=[m("查询")])),_:1})]),l("div",_l,[l("span",{onClick:t[10]||(t[10]=u=>v(Ie)(null,v(C),"/dataset/list?active=1")),class:"c-iconbackbox"},t[26]||(t[26]=[l("span",{class:"iconfont icon-fuwenben-chexiao"},null,-1),m(" 返回 ")]))])]),l("div",yl,[o(le,{ref_key:"tableRef",ref:$,data:A.value,"max-height":v(M).getters.innerHeight-238,style:{width:"100%"}},{empty:s(u=>[l("div",Vl,[o(Le,{type:"empzwssjg",width:"100",height:"100"}),t[33]||(t[33]=m("暂无数据~~"))])]),default:s(()=>[o(N,{label:"编号",width:"80",type:"index"}),o(N,{label:"id",width:"80",prop:"id"}),o(N,{label:"文档名称"},{default:s(u=>[l("span",{class:"pointer",onClick:I=>Y(2,u.row.id)},L(u.row.name),9,gl)]),_:1}),o(N,{align:"center",label:"日期"},{default:s(u=>[l("span",null,L(v(Ce)(u.row.updated_at)||v(Ce)(u.row.created_at)),1)]),_:1}),o(N,{align:"right",width:"400",label:"向量库"},{default:s(u=>[u.row.is_index?(f(),k("div",{key:0,onClick:I=>Y(3,u.row.id),class:"c-table-ibtn"},t[27]||(t[27]=[l("span",{class:"iconfont icon-liebiao-chakan"},null,-1),m(" 查看 ")]),8,bl)):q("",!0),u.row.is_markdown?(f(),k("div",{key:1,onClick:I=>ve(u.row.id),style:ne(u.row.is_index?"color:var(--el-color-primary)":""),class:"c-table-ibtn"},[t[28]||(t[28]=l("span",{class:"iconfont icon-liebiao-gengxinxiangliang"},null,-1)),l("span",xl,[m(L(u.row.is_index?"更新向量库":"添加至向量库"),1),u.row.is_index_refresh&&u.row.is_index?(f(),k("span",hl)):q("",!0)])],12,kl)):q("",!0),u.row.is_index?(f(),k("div",{key:2,onClick:I=>ae(u.row.id),class:"c-table-ibtn c-btn-del"},t[29]||(t[29]=[l("span",{class:"iconfont icon-shuzhuang-shanchu"},null,-1),m(" 从向量库删除 ")]),8,wl)):q("",!0)]),_:1}),o(N,{width:"240",align:"right",label:"操作"},{default:s(u=>[l("div",{onClick:I=>fe(u.row),class:"c-table-ibtn"},t[30]||(t[30]=[l("span",{class:"iconfont icon-liebiao-xiugaileimu"},null,-1),m(" 修改类目 ")]),8,$l),l("div",{onClick:I=>Y(2,u.row.id),class:"c-table-ibtn"},t[31]||(t[31]=[l("span",{class:"iconfont icon-xiugai"},null,-1),m(" 修改 ")]),8,Cl),l("div",{onClick:I=>ke(u.row.id),class:"c-table-ibtn c-btn-del"},t[32]||(t[32]=[l("span",{class:"iconfont icon-shuzhuang-shanchu"},null,-1),m(" 删除 ")]),8,ql)]),_:1})]),_:1},8,["data","max-height"]),V.value>0?(f(),k("div",Dl,[o(_e,{"hide-on-single-page":!1,background:"","page-size":v(r).pagesize,"current-page":v(r).page,onSizeChange:t[11]||(t[11]=u=>{v(r).pagesize=u,v(r).page=Math.min(Math.ceil(V.value/v(r).pagesize),v(r).page),h()}),onCurrentChange:t[12]||(t[12]=u=>{v(r).page=u,$.value&&$.value.scrollTo(0,0),h()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:V.value},null,8,["page-size","current-page","total"])])):q("",!0)])],64))])])])):q("",!0),c.value?(f(),Z(it,{key:1,modelValue:c.value,"onUpdate:modelValue":t[13]||(t[13]=u=>c.value=u),name:D.name,caption:D.caption,onSubfn:j,title:D.name?"修改商品类目":"添加商品类目"},null,8,["modelValue","name","caption","title"])):q("",!0),o(ot,{dataSource:x.value,modelValue:R.value,"onUpdate:modelValue":t[14]||(t[14]=u=>R.value=u),onSubfn:xe,item:K.value},null,8,["dataSource","modelValue","item"]),o(st,{xlform:T,modelValue:ue.value,"onUpdate:modelValue":t[15]||(t[15]=u=>ue.value=u)},null,8,["xlform","modelValue"])],64)}}},Kl=De(Sl,[["__scopeId","data-v-80ca6f96"]]);export{Kl as default};
