import{_ as O,d as E,u as Q,aQ as H,aR as G,i as K,aS as W,aT as Y}from"./index-B6WbZO8q.js";import{r as d,l as Z,aR as ee,z as q,B as t,R as o,O as s,u as n,aS as te,P as g,J as i,al as p,L as ae,Q as le,A as S,D as se}from"./vue-CdYMfVVj.js";import{u as ne}from"./element-GwJlJi_X.js";import{g as oe,a as ie}from"./comp-ClzPtuSi.js";import"./editor-Dhn2M38E.js";const re={class:"c-titlebox"},de={class:"title"},ue={class:"btns"},pe={class:"pagelistbox"},ce={class:"tableboxContain c-tablebox"},fe=["onClick"],ge=["onClick"],me={style:{display:"flex","align-items":"center"}},_e=["onClick"],ve=["onClick"],be=["onClick"],xe={class:"c-emptybox"},ye={key:0,class:"c-pagination"},he={class:"filename",style:{"text-align":"left","margin-bottom":"10px","font-weight":"bold"}},we={class:"uploadbox"},ke={class:"dialog-footer"},Ce={__name:"list",setup(ze){const u=ee(),k=te(),_=Q();d(!1);let r=Z({page:1,pagesize:30,knowledgebase_id:u.query.id});const x=d(0);d([]),u.query.page&&(r.page=parseInt(u.query.page)||1,r.pagesize=parseInt(u.query.pagesize)||30);let C=d([]);const c=l=>{if(H(r).then(e=>{let f=e.rows||[];C.value=f,x.value=e.total_records}),l!="noquery"){let e={...u.query,...r};k.replace({path:u.path,query:e})}};c();const L=l=>{_this.$confirm("此操作将永久删除该数据, 是否继续?").then(e=>{Y({id:l}).then(f=>{_this.$message("删除成功"),c()})})},R=l=>{W({id:l}).then(e=>{_this.$message("操作成功"),c()})},V=l=>{let e=window.location.href.split("/dataset/excel")[0]+"/api/filedatabase/download/"+l.id;E(e)},w=d(null),B=()=>{let l={knowledgebase_id:u.query.id};G(l,!0).then(e=>{e&&(_this.$message("批量更新向量库提交成功"),c("init"))})},z=d(""),I=d(""),v=d(!1),$=d(""),N=l=>{$.value=l.file_name,I.value=l.id,z.value="/api/filedatabase/update?id="+l.id,v.value=!0},b=d(null),j=(l,e,f)=>{_.commit("loading",!1),_this.$message("上传成功"),v.value=!1,c(),y.value=[],b.value&&b.value.clearFiles()},A=l=>{_.commit("loading",!1);let e=l.toString();e=e.replace("UploadAjaxError: ",""),e=JSON.parse(e),_this.$message(e.detail,"error"),b.value&&b.value.clearFiles()},y=d([]),F=(l,e)=>{y.value=e},T=l=>/\.(xlsx)$/i.test(l.name)?(_.commit("loading",!0),!0):(_this.$message("上传的文件格式不正确","error"),!1);return(l,e)=>{const f=p("el-button"),U=p("el-link"),m=p("el-table-column"),X=p("el-table"),D=p("el-pagination"),P=p("el-icon"),J=p("el-upload"),M=p("el-dialog");return S(),q(le,null,[t("div",re,[t("span",de,[t("span",{class:"c-pointer",style:{color:"#909BA5","margin-right":"5px"},onClick:e[0]||(e[0]=a=>n(oe)(null,n(k),"/dataset/list?active=3"))},e[9]||(e[9]=[s(" 全部知识库 "),t("span",{class:"iconfont icon-xiangyoujiantou"},null,-1)])),s(" "+g(n(u).query.name||"EXCEL参数库"),1)]),t("div",ue,[o(f,{size:"small",onClick:e[1]||(e[1]=a=>l.$router.push("/excel/add?id="+n(r).knowledgebase_id+"&name="+(n(u).query.name||"EXCEL参数库"))),type:"primary"},{default:i(()=>e[10]||(e[10]=[s("添加EXCEL")])),_:1}),o(f,{size:"small",onClick:e[2]||(e[2]=a=>B()),plain:""},{default:i(()=>e[11]||(e[11]=[s("批量更新向量库")])),_:1}),o(U,{style:{"margin-left":"16px"},onClick:e[3]||(e[3]=a=>n(E)("/api/filedatabase/template"))},{default:i(()=>e[12]||(e[12]=[t("span",{class:"iconfont icon-anniu-xiazai"},null,-1),s(" 下载EXCEL模板")])),_:1})])]),t("div",pe,[t("div",ce,[o(X,{ref_key:"tableRef",ref:w,data:n(C),"max-height":n(_).getters.innerHeight-141,style:{width:"100%"}},{empty:i(a=>[t("div",xe,[o(K,{type:"empzwssjg",width:"100",height:"100"}),e[18]||(e[18]=s("暂无数据~~"))])]),default:i(()=>[o(m,{width:"80",type:"index",label:"编码"}),o(m,{label:"模板"},{default:i(a=>[s(g(a.row.template_name),1)]),_:1}),o(m,{label:"文件名称"},{default:i(a=>[s(g(a.row.file_name),1)]),_:1}),o(m,{align:"center",label:"日期"},{default:i(a=>[s(g(n(ie)(a.row.updated_at)),1)]),_:1}),o(m,{label:"文件大小"},{default:i(a=>[s(g(a.row.file_size),1)]),_:1}),o(m,{width:"360",align:"right",label:"操作"},{default:i(a=>[t("div",{onClick:h=>N(a.row),class:"c-table-ibtn"},e[13]||(e[13]=[t("span",{class:"iconfont icon-xiugai"},null,-1),s(" 修改 ")]),8,fe),t("div",{onClick:h=>R(a.row.id),style:se(a.row.index_at?"color:var(--el-color-primary)":""),class:"c-table-ibtn"},[e[14]||(e[14]=t("span",{class:"iconfont icon-liebiao-gengxinxiangliang"},null,-1)),t("span",me,g(a.row.index_at?"更新向量":"添加向量"),1)],12,ge),t("div",{onClick:h=>V(a.row),class:"c-table-ibtn"},e[15]||(e[15]=[t("span",{class:"iconfont icon-anniu-xiazai"},null,-1),s(" 下载 ")]),8,_e),t("div",{onClick:h=>l.$router.push({path:"/excel/detail",query:{id:a.row.id,fpath:n(u).fullPath}}),class:"c-table-ibtn"},e[16]||(e[16]=[t("span",{class:"iconfont icon-liebiao-chakan"},null,-1),s(" 查看 ")]),8,ve),t("div",{onClick:h=>L(a.row.id),class:"c-table-ibtn c-btn-del"},e[17]||(e[17]=[t("span",{class:"iconfont icon-shuzhuang-shanchu"},null,-1),s(" 删除 ")]),8,be)]),_:1})]),_:1},8,["data","max-height"]),x.value>0?(S(),q("div",ye,[o(D,{"hide-on-single-page":!1,background:"","page-size":n(r).pagesize,"current-page":n(r).page,onSizeChange:e[4]||(e[4]=a=>{n(r).pagesize=a,n(r).page=Math.min(Math.ceil(x.value/n(r).pagesize),n(r).page),c()}),onCurrentChange:e[5]||(e[5]=a=>{n(r).page=a,w.value&&w.value.scrollTo(0,0),c()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:x.value},null,8,["page-size","current-page","total"])])):ae("",!0)])]),o(M,{"align-center":"",modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=a=>v.value=a),title:"修改文件",width:"800"},{footer:i(()=>[t("div",ke,[o(f,{plain:"",onClick:e[7]||(e[7]=a=>{v.value=!1})},{default:i(()=>e[20]||(e[20]=[s("取消")])),_:1})])]),default:i(()=>[t("div",he,"文件名称："+g($.value),1),t("div",we,[o(J,{class:"upload-demo",ref_key:"upload",ref:b,"file-list":y.value,"onUpdate:fileList":e[6]||(e[6]=a=>y.value=a),headers:{authorization:"Bearer "+n(_).state.token},"before-upload":T,"on-change":F,"show-file-list":!1,"on-error":A,"on-success":j,limit:1,multiple:"",drag:"",action:z.value},{default:i(()=>[o(P,{class:"el-icon--upload"},{default:i(()=>[o(n(ne))]),_:1}),e[19]||(e[19]=t("div",{style:{display:"flex","align-items":"center","flex-wrap":"wrap"},class:"el-upload__text"},[t("div",{style:{"text-align":"left",margin:"0 auto"},class:"tip"},[s(" 选择要修改的Excel文件,支持 .xlsx 类型文件 "),t("br"),s(" Excel数据修改规则:"),t("br"),s(" 1、Excel数据修改，必须全量上传。"),t("br"),s(' 2、严格按照新Exce数据中的"唯一编码"进行新增、修改、删除操作。'),t("br"),s(" 3、修改后需要重新向量化。 "),t("br")])],-1))]),_:1},8,["file-list","headers","action"])])]),_:1},8,["modelValue"])],64)}}},Re=O(Ce,[["__scopeId","data-v-425ca7f8"]]);export{Re as default};
