import{j as D,r as p,I as v,J as d,B as n,R as s,al as u,z as _,a6 as x,Q as w,O as b,L as h,P as V,n as I,aR as A,aS as F,A as i,E as L,W as J}from"./vue-CdYMfVVj.js";import{_ as P,i as Q,b8 as W,u as G,V as K}from"./index-B6WbZO8q.js";const Y={class:"xlcontent"},Z={class:"mg20"},ee={class:"contextbox"},le={class:"xltitle"},te={class:"c-primary-btn c-mini"},oe={key:0,style:{"padding-bottom":"24px"},class:"c-emptybox"},ae={class:"title"},se={class:"filename ellipsis"},ne=["title"],de=["innerHTML"],ie=["onClick"],ue={class:"score tl"},re={class:"c-scorebox"},pe={__name:"xltest",props:{xlform:{type:Object,default:{knowledgebase_k:5,knowledgebase_ids:[],file_knowledgebase_ids:[],product_model_ids:[],file_knowledgebase_k:5,product_model_top_k:5,question:""}},type:{type:String,default:"text"},title:{type:String,default:"向量检测"},modelValue:{type:Boolean,default:!1}},emits:["subfn","update:modelValue"],setup(S,{emit:$}){const C=S,j=$;A(),F(),G(),D(()=>C.modelValue,(t,e)=>{k.value=t,t&&t!==e&&T()});const f=p([]),y=p([]),g=p([]),T=()=>{if(a.value=C.xlform,c.value=[],f.value.length>0&&y.value.length>0&&g.value.length>0)return!1;K().then(t=>{let e=t||[];f.value=[],y.value=[],g.value=[],e.forEach(o=>{o.type==2?y.value.push(o):o.type==1?f.value.push(o):o.type==3&&g.value.push(o)})})},B=()=>{j("update:modelValue",!1)},a=p({knowledgebase_k:5,knowledgebase_ids:[],file_knowledgebase_ids:[],product_model_ids:[],file_knowledgebase_k:5,product_model_top_k:5,question:""}),O=()=>{if(!a.value.question)return!1;W(a.value).then(t=>{t.forEach(e=>{e.isOpen=!1}),c.value=t,I(()=>{document.querySelectorAll(".js-intro").forEach((o,m)=>{o.offsetHeight<o.querySelector(".text").offsetHeight&&(o.querySelector(".js-btn").style.cssText="")})})})},U=t=>"c-topicon"+({knowledge_document:1,product_model:2,excel_document:3}[t]||1),z=t=>{if(t.metadata.detali_url)window.open(t.metadata.detali_url);else{let e=t.metadata.knowledgebase_id,o=t.metadata.type,m=t.metadata.ref_real_id,r=t.metadata.ref_id;window.open(`/chat/detail?id=${e}&type=${o}&did=${m}&rid=${r}`)}},c=p([]),k=p(!1);return p(0),(t,e)=>{const o=u("el-option"),m=u("el-select"),r=u("el-form-item"),E=u("el-input-number"),M=u("el-input"),q=u("el-button"),H=u("el-form"),N=u("el-scrollbar"),R=u("el-drawer");return i(),v(R,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),title:"向量检测",onClosed:B,direction:"rtl",size:"800px"},{default:d(()=>[n("div",Y,[s(N,null,{default:d(()=>[n("div",Z,[s(H,{class:"tl",inline:"",model:a.value,"label-width":"auto","label-position":"top"},{default:d(()=>[s(r,{style:{width:"calc(100% - 236px)","margin-right":"16px"},label:"文本知识库"},{default:d(()=>[s(m,{modelValue:a.value.knowledgebase_ids,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.knowledgebase_ids=l),multiple:"","collapse-tags":"","max-collapse-tags":2,placeholder:"请选择文本知识库"},{default:d(()=>[(i(!0),_(w,null,x(f.value,l=>(i(),v(o,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(r,{style:{width:"220px","margin-right":"0"},label:"top_k"},{default:d(()=>[s(E,{style:{width:"100%"},placeholder:"请填写文本top_k",modelValue:a.value.knowledgebase_k,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.knowledgebase_k=l),min:0,max:1e3,precision:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),s(r,{style:{width:"calc(100% - 236px)","margin-right":"16px"},label:"EXCEL参数库"},{default:d(()=>[s(m,{modelValue:a.value.file_knowledgebase_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.file_knowledgebase_ids=l),multiple:"","collapse-tags":"","max-collapse-tags":2,placeholder:"请选择EXCEL参数库"},{default:d(()=>[(i(!0),_(w,null,x(g.value,l=>(i(),v(o,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(r,{style:{width:"220px","margin-right":"0"},label:"EXCEL参数库top_k"},{default:d(()=>[s(E,{style:{width:"100%"},placeholder:"请填写EXCEL参数库top_k",modelValue:a.value.file_knowledgebase_k,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.file_knowledgebase_k=l),min:0,max:1e3,precision:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),s(r,{style:{width:"100%","margin-right":"0px"},label:"检测内容"},{default:d(()=>[s(M,{modelValue:a.value.question,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.question=l),style:{width:"100%"},class:"autofocus",type:"text",placeholder:"请填写检测内容"},null,8,["modelValue"]),s(q,{onClick:e[5]||(e[5]=l=>O()),style:{position:"absolute",right:"0",top:"0","border-radius":"var(--el-border-radius-base)"},type:"primary"},{default:d(()=>e[7]||(e[7]=[b("检测")])),_:1})]),_:1})]),_:1},8,["model"]),n("div",ee,[n("div",le,[e[8]||(e[8]=b("检测结果 ")),n("span",te,V(c.value.length),1)]),c.value.length<1?(i(),_("div",oe,[s(Q,{type:"empzwssjg",width:"100",height:"100"}),e[9]||(e[9]=b("暂无检测结果 "))])):h("",!0),(i(!0),_(w,null,x(c.value,(l,_e)=>(i(),_("div",{key:l.metadata.knowledgebase_id+"_"+l.ref_real_id+"_"+l.ref_id+"_"+l.metadata.id,class:"item"},[n("div",ae,[n("span",{class:L(U(l.metadata.type))},null,2),n("div",se,V(l.metadata.filename),1)]),n("div",{title:l.page_content,class:L(["intro js-intro",{open:l.isOpen}])},[n("div",{innerHTML:l.page_content.replace(/\n/g,"<br>"),class:"text"},null,8,de),l.isOpen?h("",!0):(i(),_("span",{key:0,onClick:X=>{l.isOpen=!0},style:{display:"none"},class:"js-btn"},"展开",8,ie))],10,ne),n("div",ue,[n("div",re,V(l.metadata.score||0),1),t.$route.path!="/sharechat"?(i(),v(q,{key:0,size:"small",onClick:J(X=>z(l),["stop"]),type:"primary"},{default:d(()=>e[10]||(e[10]=[b("查看文档")])),_:2},1032,["onClick"])):h("",!0)])]))),128))])])]),_:1})]),e[11]||(e[11]=n("br",null,null,-1))]),_:1},8,["modelValue"])}}},fe=P(pe,[["__scopeId","data-v-d8610dec"]]);export{fe as x};
