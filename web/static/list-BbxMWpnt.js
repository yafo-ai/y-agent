import{aR as re,aS as de,r as C,h as ke,X as Ce,z as q,A as E,B as l,j as ge,l as ne,I as ie,J as y,L as ee,R as m,Q as ae,a6 as _e,al as z,E as G,P as K,D as fe,O as P,u as le,g as we,n as Se,W as Z,a4 as $e}from"./vue-CdYMfVVj.js";import{_ as ue,u as ce,l as V,X as Ve,b9 as Ie,ba as ze,bb as ye,bc as De,c as Ne,bd as Ee,i as Ae,be as Me,bf as Re,bg as je}from"./index-B6WbZO8q.js";import{a as Le}from"./comp-ClzPtuSi.js";import{C as Pe,E as Fe,K as Be,a as qe,M as He,b as Ue,P as Oe,R as Ke,S as We,c as Ye,T as Qe,U as Xe,e as oe,l as B}from"./editor.api-_A1huWdg.js";import"./list.vue_vue_type_style_index_1_lang-B8pmpZgU.js";const Je=Object.freeze(Object.defineProperty({__proto__:null,CancellationTokenSource:Pe,Emitter:Fe,KeyCode:Be,KeyMod:qe,MarkerSeverity:He,MarkerTag:Ue,Position:Oe,Range:Ke,Selection:We,SelectionDirection:Ye,Token:Qe,Uri:Xe,editor:oe,languages:B},Symbol.toStringTag,{value:"Module"})),Ze={class:"editor-containbox nodrag nowheel"},d="$0",Ge={__name:"editor",props:{nodes:{type:[Array],default:()=>[]},edges:{type:[Array],default:()=>[]},nodeid:{type:String,default:""},lineNumbers:{type:String,default:"off"},fontSize:{type:[String,Number],default:12},language:{type:String,default:"python"},modelValue:{type:String,default:""}},emits:["subfn","update:modelValue"],setup(R,{expose:te,emit:h}){const w=R,T=h;re(),de(),ce(),C(!1);const H=C(null);let D=null;const Q=[{sym:" ",children:[{label:"强调输出格式的指令",detail:"当大模型输出指令经常错的时候,添加此提示词",insertText:"注意:工具指令不可篡改,不可遗漏,必须以command=|<|开始，以|>|结束。"+d},{label:"send_message",detail:"向聊天室发送消息",insertText:'command=|<|send_message(receiver="填写接受消息的角色名称",message="填写消息的内容") |>|'+d},{label:"notify",detail:"向用户发送消息（发送完流程继续运行）",insertText:'command=|<|notify(message="填写消息的内容")|>|'+d},{label:"terminate",detail:"向用户发送消息（发送完流程终止）",insertText:'command=|<|terminate(message="向用户发消息此处可以填写固定值或者变量")|>|'+d},{label:"write_var",detail:"写入space工作空间环境变量",insertText:"command=|<|write_var(参数名=值,参数名=值)|>|"+d},{label:"assignment",detail:"指定选择某个下游节点角色执行后续流程",insertText:'command=|<|assignment(next_roles=[{"role":"角色1","message":"消息1"},{"role":"角色2","message":"消息2"}])|>|'+d},{label:"if",detail:"if代码块",insertText:"{% if  "+d+` %}\r
\r
{% else %}\r
\r
{% endif %}`},{label:"for",detail:"for代码块",insertText:`{% for v in \${1:变量名称} %}\r
{{v}}\r
{% endfor %}`},{label:"batch",detail:"batch代码块，批处理使用的内部临时变量，batch存储的是，当前批次的数据集",insertText:"{{batch"+d+"}}"},{label:"for_batch例子",detail:"案例::for循环遍历，当前批次存储的数据集",insertText:`{% for doc in batch.item %}\r
doc.id\r
{% endfor %}`}]},{sym:"batch",isIndex:!0,children:[{sym:"index",label:"index",detail:"当前批次的序号",insertText:"index"},{sym:"item",label:"item",detail:"当前批次存储的数据集，可以用for循环遍历",insertText:"item"},{sym:"item[n]",label:"item[n]",detail:"指定取本批次的第n条数据，n为从0开始的整数",insertText:"item[${1:0}]"}]},{sym:"sys",isIndex:!0,children:[{sym:"space",label:"space",detail:"工作空间",insertText:"space"+d,children:[{sym:"",label:"",detail:"获取当前流程工作空间变量加入提示",type:"space"}]},{sym:"chat_room",label:"chat_room",detail:"聊天室，不可以直接使用，必须使用其中的方法或者属性",insertText:"chat_room"+d,children:[{sym:"get_talks()",endlen:1,label:"get_talks()",detail:"返回聊天详细信息 id、message、time、sender、receiver",insertText:"get_talks()"+d,children:[{sym:"first(",label:"first(n)",detail:"最早的n条",insertText:"first(n)"+d},{sym:"last(",label:"last(n)",detail:"最后n条",insertText:"last(n)"+d},{sym:"message",label:"message",detail:"返回所有符合条件的聊天内容",insertText:"message"+d,children:[{label:"first(n)",detail:"最早的n条",insertText:"first(n)"+d},{label:"last(n)",detail:"最后n条",insertText:"last(n)"+d}]}]},{sym:'get_talks("',endlen:4,isIndex:!0,label:'.get_talks("发送者","接收者")',detail:"get_talks的另外写法",insertText:'get_talks("发送者","接收者")'+d,children:[{sym:"message",label:"message",detail:"返回聊天详细信息 id、message、time、sender、receiver",insertText:"message"+d,children:[{label:"first(n)",detail:"时间最早的n条",insertText:"first(n)"+d},{label:"last(n)",detail:"最后n条",insertText:"last(n)"+d}]}]}]},{label:"is_null_or_empty()",detail:"判断变量是否null或者为空（包括数组长度为0的情况）",insertText:"is_null_or_empty(${1:变量名})"+d},{label:"contains(A,B)",detail:"查询字符串A是否包含字符串B",insertText:'contains("字符串1","字符串2")'+d},{label:"time()",detail:"当前服务器时间 HH:MM:SS",insertText:"time()"+d},{label:"date()",detail:"当前服务器日期 YYYY-MM-DD",insertText:"date()"+d},{label:"datetime()",detail:"当前服务器日期时间",insertText:"datetime()"+d},{label:"get_documents_text()",detail:"根据文档id获取文档内容",insertText:"get_documents_text()([${1:id1},${2:id2}])])"},{sym:"get_documents_json(",isIndex:!0,label:"get_documents_json()",detail:"根据文档id获取文档json格式内容",insertText:"get_documents_json()([${1:id1},${2:id2}])])",children:[{label:'field(["字段1","字段2"])',detail:"提取json数组的指定字段",insertText:'field(["${1:字段1}","${2:字段2}"])'},{label:"id",detail:"仅返回选中字段的数据",insertText:"id"},{label:"title",detail:"仅返回选中字段的数据",insertText:"title"},{label:"content",detail:"仅返回选中字段的数据",insertText:"content"},{label:"score",detail:"仅返回选中字段的数据",insertText:"score"}]},{label:"current_token",detail:"获取当前执行流程的用户的身份",insertText:"current_token"+d},{sym:"test",isIndex:!0,label:"test",detail:"测试模块专用变量",insertText:"test",children:[{label:"input",detail:"测试的input参数",insertText:"input"},{label:"right_answer",detail:"参考的正确答案",insertText:"right_answer"},{label:"answer",detail:"当前模型输出的答案",insertText:"answer"},{label:"standard",detail:"测试评分标准",insertText:"standard"}]}]},{sym:"role",isIndex:!0,children:[{sym:"input|开始",label:"input/开始",isIndex:!0,detail:"",insertText:"input"+d,children:[{sym:"",label:"",detail:"自定义输入",type:"start"}]},{sym:"",label:"",detail:"不可以直接使用，必须使用其中的方法或者属性",type:"role",children:[{sym:"var",label:"var",detail:"角色自身变量输出",insertText:"var"+d,children:[{sym:"",label:"",detail:"",type:"var"}]},{label:"output",detail:"角色输出内容",insertText:"output"+d},{sym:"",label:"",detail:"工具返回值",type:"tool"}]},{label:"get_roles_outputs()",detail:"同时取多个角色的输出，并合并",insertText:"get_roles_outputs([role1,role2...],field_key)"+d}]}];ke(()=>{setTimeout(()=>{c()},70)});let F=null;const c=o=>{if(D&&D.dispose(),!(Je&&oe))return F=setTimeout(()=>{c(o)},200),!1;D=oe.create(H.value,{value:w.modelValue,language:w.language,contextmenu:!1,quickSuggestions:!1,fontSize:w.fontSize||14,fontFamily:"'Helvetica Neue', Helvetica, Tahoma, Arial, 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'Heiti SC', 'WenQuanYi Micro Hei', sans-serif !important",lineNumbers:w.lineNumbers||"off",hover:!1,minimap:{enabled:!1}}),o&&D.setValue(o),D.onDidFocusEditorText(()=>{X()}),D.onDidChangeModelContent(i=>{T("update:modelValue",D.getValue())})};Ce(()=>{clearTimeout(F),D&&D.dispose()}),te({setValue:o=>{T("update:modelValue",o),c(o)}});const X=()=>{B.registerCompletionItemProvider[w.language]&&B.registerCompletionItemProvider[w.language].dispose(),B.registerCompletionItemProvider[w.language]=B.registerCompletionItemProvider(w.language,{provideCompletionItems:(o,i,$,b)=>{const f=i.lineNumber,e=i.column,s=o.getLineContent(f)[e-2];let r=o.getWordUntilPosition(i),u={startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn},g=[],v=V.cloneDeep(w.edges);w.nodes.forEach(A=>{(A.data.type=="work_space"||A.data.type=="start")&&g.push(A),w.nodeid&&A.id==w.nodeid});function p(A,x){const M=[],W=new Set,J=[x];for(;J.length>0;){const a=J.pop();if(!W.has(a)){W.add(a);for(const t of A)if(t.target===a){const S=t.sourceNode;S.data.type!=="start"&&S.data.type!=="work_space"&&(W.has(S.id)||(M.push(S),J.push(S.id)))}}}return M}w.nodeid?g.push(...p(v,w.nodeid)):g=V.cloneDeep(w.nodes);let I=[];return r=o.getWordUntilPosition(i),u={startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:s==" "?r.startColumn-1:r.startColumn,endColumn:r.endColumn},console.log(u,r,s==" "),I=[{label:"log",kind:B.CompletionItemKind.Function,insertText:"log($1)$0",insertTextRules:B.CompletionItemInsertTextRule.InsertAsSnippet,detail:"替换整个触发词(包括.)",range:u}],I=U(o,i,g),console.log(I),{suggestions:I}},triggerCharacters:[".","{","%"," ",'"',"="," ","s","n","t","w","i","f","l"]})};function U(o,i,$){const b=i.lineNumber,f=i.column,e=o.getLineContent(b),n=e[f-2];console.log(o,i,b,f,e,n);let s=o.getWordUntilPosition(i),r={startLineNumber:i.lineNumber,endLineNumber:i.lineNumber,startColumn:s.startColumn,endColumn:s.endColumn},u=[];if(n==" "&&e.length<2){r.startColumn=s.startColumn-1;let g=[];Q.forEach(v=>{v.sym===n&&(g=v.children)}),g.forEach((v,p)=>{u.push({label:v.label,sortText:"a"+p,insertText:v.insertText,insertTextRules:B.CompletionItemInsertTextRule.InsertAsSnippet,detail:v.detail,range:r})})}else if(n=="."){let g=e.split(" ");f>1&&(g=e.substring(0,f-1).split(" "));let v=g[g.length-1].split(".");v.pop(),L(V.cloneDeep($),V.cloneDeep(v)).forEach((I,A)=>{I.sym===""?k(V.cloneDeep($),I,V.cloneDeep(v)).forEach((M,W)=>{u.push({label:M.label,sortText:"a"+W,insertText:M.insertText,insertTextRules:B.CompletionItemInsertTextRule.InsertAsSnippet,detail:M.detail,range:r})}):u.push({label:I.label,sortText:"a"+A,insertText:I.insertText,insertTextRules:B.CompletionItemInsertTextRule.InsertAsSnippet,detail:I.detail,range:r})})}return u}function k(o,i,$){let b=i.type,f=[];if(b==="role")o.forEach(e=>{e.data.type!="work_space"&&e.data.type!="start"&&f.push({sym:e.data.role,label:e.data.role,insertText:e.data.role+d,detail:i.detail})});else if(b==="tool"){let e=L(V.cloneDeep(o),V.cloneDeep($),void 0,!0);if(console.log(e),e&&e.data.functions&&e.data.functions.length>0){let n=e.data.functions;for(let s=0;s<n.length;s++){let r=n[s];f.push({sym:r.fun_name,label:r.fun_name,insertText:r.fun_name+d,detail:r.name})}}}else if(b==="var"){let e=L(V.cloneDeep(o),V.cloneDeep($),void 0,!0);if(e&&e.data.outputs&&e.data.outputs.length>0){let n=[];e.contents.length<=1?n=e.data.outputs:(e.contents.shift(),n=N(V.cloneDeep(e.data.outputs),V.cloneDeep(e.contents)));for(let s=0;s<n.length;s++){let r=n[s];f.push({sym:r.name,label:r.name,insertText:r.name+d,detail:i.detail})}}}else if(b==="start"){let e=L(V.cloneDeep(o),V.cloneDeep($),void 0,!0);if(e&&e.data.inputs&&e.data.inputs.length>0){let n=[];e.contents.length<1?n=e.data.inputs:n=N(V.cloneDeep(e.data.inputs),V.cloneDeep(e.contents));for(let s=0;s<n.length;s++){let r=n[s];f.push({sym:r.name,label:r.name,insertText:r.name+d,detail:i.detail})}}}else if(b==="space"){let e=null;if(o.forEach(n=>{n.data.type=="work_space"&&(e=n)}),e&&e.data.space_vars&&e.data.space_vars.length>0){let n=e.data.space_vars;for(let s=0;s<n.length;s++){let r=n[s];f.push({sym:r.name,label:r.name,insertText:r.name+d,detail:i.detail})}}}return f}function N(o,i,$){let b=i[0],f=[];if(b===""||b===void 0)return i.shift(),i.length<1?$||[]:N(o,i,$);for(let e=0;e<o.length;e++){let n=o[e];if(n.name===b){if(i.shift(),i.length<1)return f=n.children||[],f;{let s=n.children||[];f=N(s,i,s)}}}return f}function L(o,i,$,b){let f=i[0],e=$||Q,n=[],s=null;if(f===""||f===void 0)return i.shift(),i.length<1?$||[]:L(V.cloneDeep(o),i,$,b);for(let r=0;r<e.length;r++){let u=e[r];if(u.sym===""){if(u.type==="role"?o.forEach(g=>{g.data.type!="work_space"&&g.data.type!="start"&&g.data.role===f&&(s=g)}):u.type==="start"&&o.forEach(g=>{g.data.type=="start"&&(s=g)}),s){if(i.shift(),b)return s.contents=i,s;i.length<1?n=u.children:n=L(V.cloneDeep(o),i,u.children,b)}}else if(u.sym){let g=u.sym.split("|"),v=-1;for(let p=0;p<g.length;p++){let I=g[p];(I===f||u.isIndex&&f.indexOf(I)!==-1)&&(v=p)}if(v!==-1){if(i.shift(),b&&u.sym==="input|开始")return o.forEach(p=>{p.data.type=="start"&&(s=p)}),s.contents=i,s;i.length<1||u.sym==="var"||u.sym==="input|开始"?n=u.children:n=L(V.cloneDeep(o),i,u.children,b)}}}return n}return(o,i)=>(E(),q("div",Ze,[l("div",{ref_key:"editorContainer",ref:H,class:"editor-container c-scroll-contain"},null,512)]))}},et=ue(Ge,[["__scopeId","data-v-865ea25c"]]),tt={class:"dialogFormVisible1box"},nt={key:0,class:"historybox c-history"},lt={class:"mg20"},st=["onClick"],it=["title"],at={style:{"margin-left":"5px"},class:"c-warn-btn c-mini radius"},ot={class:"timebox"},rt={class:"time"},dt={class:"contentbox"},ut={class:"dialog-footer"},ct={__name:"edit",props:{id:{type:[String,Number],default:()=>0},curflowid:{type:[String,Number],default:""},curdataid:{type:[String,Number],default:""},title:{type:[String,Number],default:""},nodes:{type:[Array],default:()=>[]},edges:{type:[Array],default:()=>[]},nodeid:{type:String,default:""},item:{type:Object,default:{name:"",content:"",id:void 0,prompt_type_id:null}},modelValue:{type:Boolean,default:!1}},emits:["subfn","update:modelValue","errfn"],setup(R,{emit:te}){const h=R,w=te;re(),de(),ce();const T=C(!1),H=C([]);ge(()=>h.modelValue,async(e,n)=>{if(b.value="",e!==n&&e){let s=await ye();H.value=s||[]}h.item&&U(h.item),h.item&&h.item.id&&e&&!n?De(h.item.id).then(s=>{j.value=s||[],s&&s.length>0&&F(s[0])}).catch(s=>{w("errfn",s.response&&s.response.data),D()}):T.value=e});const D=()=>{T.value=!1,w("update:modelValue",!1)},Q=C(0),F=e=>{Q.value=e.ver,ze({ver:e.ver,id:e.id}).then(n=>{n&&(n.id=e.id,U(n),T.value=!0)})},c=ne({name:"",content:"",id:void 0,prompt_type_id:null}),j=C([]),X=C(""),U=e=>{c.id=e.id,c.name=e.name,c.content=e.content,c.prompt_type_id=e.prompt_type_id?parseInt(e.prompt_type_id,10):null,X.value=e.name+e.content+e.prompt_type_id,$.value&&$.value.setValue(c.content)},k=C(),N=ne({name:[{required:!0,message:"请输入提示词名称"}]}),L=async e=>{e&&e.validate(n=>{if(n)Ie(c).then(s=>{s&&(s.id&&(c.id=s.id),_this.$message("提交成功"),w("subfn",c))});else return!1})},o=C(window.innerHeight-290),i=C("1600px");window.innerWidth>2200&&(i.value="2000px"),window.innerWidth<1400&&(i.value="100%");const $=C(null),b=C(""),f=()=>{Ve({flow_id:h.curflowid,runner_id:h.curdataid+"",prompt_temp:c.content}).then(e=>{b.value=e.prompt_str})};return(e,n)=>{const s=z("el-scrollbar"),r=z("el-input"),u=z("el-form-item"),g=z("el-tree-select"),v=z("el-button"),p=z("v-md-preview"),I=z("el-form"),A=z("el-drawer");return E(),ie(A,{direction:"rtl",modelValue:T.value,"onUpdate:modelValue":n[5]||(n[5]=x=>T.value=x),title:c.id?"修改提示词":"创建提示词",onClose:D,"destroy-on-close":!0,size:"90%"},{default:y(()=>[l("div",tt,[j.value.length>0&&c.id?(E(),q("div",nt,[m(s,null,{default:y(()=>[l("div",lt,[n[6]||(n[6]=l("div",{class:"title1"},"历史记录",-1)),(E(!0),q(ae,null,_e(j.value,x=>(E(),q("div",{onClick:M=>F(x),key:x.ver,class:G([{on:x.ver==Q.value},"item"])},[l("div",{title:x.name,class:"name ellipsis3"},[P(K(x.name)+" ",1),l("span",at,K(x.ver),1)],8,it),l("div",ot,[l("span",rt,K(le(Le)(x.created_at)),1)])],10,st))),128))])]),_:1})])):ee("",!0),l("div",{class:G(["formbox",{on:!(j.value.length>0&&c.id)}])},[m(I,{ref_key:"ruleFormRef1",ref:k,rules:N,"label-width":"auto","label-position":"top",inline:"",model:c},{default:y(()=>[m(u,{label:"提示词名称",style:{width:"calc(100% - 316px)"},prop:"name"},{default:y(()=>[m(r,{class:"autofocus inp2",placeholder:"请输入提示词名称",modelValue:c.name,"onUpdate:modelValue":n[0]||(n[0]=x=>c.name=x),maxlength:"50",autocomplete:"off"},null,8,["modelValue"])]),_:1}),m(u,{label:"提示词分类",style:{width:"300px","margin-right":"0"},prop:"prompt_type_id"},{default:y(()=>[m(g,{modelValue:c.prompt_type_id,"onUpdate:modelValue":n[1]||(n[1]=x=>c.prompt_type_id=x),filterable:"","check-strictly":"","node-key":"id",props:{children:"children",label:"name",value:"id"},"default-expand-all":!0,"check-on-click-node":!0,data:H.value,style:{width:"100%"}},{default:y(({node:x,data:M})=>[l("span",null,K(M.name),1)]),_:1},8,["modelValue","data"])]),_:1}),m(u,{style:{width:"100%","margin-right":"0",position:"relative"},label:"提示词内容",prop:"caption"},{label:y(()=>[n[8]||(n[8]=l("span",null,"提示词内容",-1)),n[9]||(n[9]=l("span",{style:{display:"inline-flex","align-items":"center"},class:"c-tips"},[l("span",{style:{"margin-right":"5px"},class:"iconfont icon-bangzhu1"}),P("调用本系统内置函数可以使用：sys. role. [空格]. 触发提示下拉框。提示词模板使用jinja模板，更多语法参考jinja官方文档。")],-1)),h.curdataid&&h.curflowid?(E(),ie(v,{key:0,onClick:f,style:{position:"absolute",right:"10px",top:"0px"},type:"primary",plain:"",size:"small"},{default:y(()=>n[7]||(n[7]=[P("运行一次 "),l("span",{class:"iconfont icon-liebiao-zhihang"},null,-1)])),_:1})):ee("",!0)]),default:y(()=>[l("div",dt,[l("div",{style:fe("height:"+o.value+"px;"+(h.curdataid&&h.curflowid?"width:50%":"width:100%"))},[m(et,{lineNumbers:"on",fontSize:14,ref_key:"editor",ref:$,nodes:R.nodes,edges:R.edges,nodeid:R.nodeid,modelValue:c.content,"onUpdate:modelValue":n[2]||(n[2]=x=>c.content=x)},null,8,["nodes","edges","nodeid","modelValue"])],4),h.curdataid&&h.curflowid?(E(),q("div",{key:0,class:"previewbox",style:fe("height:"+o.value+"px;width:calc(50% - 20px)")},[m(s,null,{default:y(()=>[m(p,{text:b.value},null,8,["text"])]),_:1})],4)):ee("",!0)])]),_:1})]),_:1},8,["rules","model"])],2)]),l("div",ut,[m(v,{type:"primary",onClick:n[3]||(n[3]=x=>L(k.value))},{default:y(()=>n[10]||(n[10]=[P(" 确定 ")])),_:1}),m(v,{onClick:n[4]||(n[4]=x=>D()),plain:""},{default:y(()=>n[11]||(n[11]=[P("取消")])),_:1})])]),_:1},8,["modelValue","title"])}}},pt=ue(ct,[["__scopeId","data-v-43f3eadb"]]),mt={class:"catebox leftbox"},ft={class:"topbtns"},gt={class:"contain"},_t={class:"el-tree el-tree--highlight-current",role:"tree",style:{width:"100%"}},yt={class:"el-tree-node__content"},ht=["title"],bt={class:"item"},vt={class:"ellipsis"},xt={class:"btns"},Tt=["onClick"],kt=["onClick"],Ct=["onClick"],wt={class:"botbtns"},St={class:"scrollbox rightbox"},$t={class:"contain"},Vt={class:"c-cardbox"},It={key:0,class:"c-emptybox"},zt=["onClick"],Dt=["onClick"],Nt=["onClick"],Et={class:"top ellipsis"},At={class:"title ellipsis"},Mt={class:"intro"},Rt={class:"ellipsis3"},jt={class:"base_name"},Lt={style:{margin:"0 -20px"}},Pt=["innerHTML"],Ft={key:0,style:{"padding-right":"20px"},class:"c-pagination"},Bt={class:"formbox"},qt={class:"dialog-footer"},Ht={__name:"list",props:{proType:{type:[String,Number],default:()=>""},curflowid:{type:[String,Number],default:""},curdataid:{type:[String,Number],default:""},nodes:{type:[Array],default:()=>[]},edges:{type:[Array],default:()=>[]},nodeid:{type:String,default:""},isCheck:{type:[Boolean],default:()=>!1},checkList:{type:[Array],default:()=>[]}},emits:["subfn"],setup(R,{emit:te}){const h=re(),w=de(),T=R;ge(()=>T.checkList,a=>{H()});const H=()=>{let a=c.value;a.forEach(t=>{t.checked=!1,T.checkList.forEach(S=>{t.id==S.id&&(t.checked=!0)})}),c.value=a},D=ce();let{proxy:Q}=we();const F=C(!1);let c=C([]);const j=C(0),X=C(1),U=C(36);h.query.page&&(X.value=parseInt(h.query.page)),h.query.pagesize&&(U.value=parseInt(h.query.pagesize));const k=ne({page:X.value||1,pagesize:U.value||30,type:T.proType||void 0,prompt_type_id:T.proType||null});Ne(k,h.query,"prompt_type_id");const N=a=>{if(a=="init"&&(k.page=1,k.pagesize=U.value||30),Ee(k).then(t=>{let S=t.rows||[];T.proType?(S=t||[],j.value=0):j.value=t.total_records,c.value=S,H()}),a!="noquery"&&h.path=="/app/list"){let t={...h.query,...k};w.replace({path:h.path,query:t})}};N("noquery");const L=te,o=a=>{T.proType||T.isCheck?(a.checked=!a.checked,console.log(a),L("subfn",[V.cloneDeep(a)])):i(a)},i=async a=>{$(),a&&b(a),F.value=!0},$=()=>{e.id="",e.name="",e.content="",e.prompt_type_id=k.prompt_type_id||null},b=a=>{e.id=a.id,e.name=a.name,e.content=a.content,e.prompt_type_id=a.prompt_type_id||null},f=a=>{_this.$confirm("此操作将永久删除该知识库, 是否继续?").then(t=>{Re({id:a}).then(S=>{_this.$message("删除成功"),N()})})},e=ne({name:"",content:"",id:void 0,prompt_type_id:null}),n=C(null),s=C([]),r=C(null),u=async a=>{console.log(a),k.prompt_type_id=a.id,N("init")},g=a=>{ye().then(async t=>{s.value=t||[],await Se(),r.value.setCurrentKey(parseInt(k.prompt_type_id))}).catch(t=>{})};g();const v=C(!1),p=ne({name:"",id:0,note:"",pid:0}),I=async(a,t)=>{p.pid=a.pid||0,p.id=a.id||0,p.name=a.name||"",p.note=a.note||"",t=="child"&&(p.pid=a.id,p.name="",p.note="",p.id=void 0),v.value=!0,setTimeout(()=>{x.value.focus()},500)},A=a=>{_this.$confirm("确定要删除所选数据?").then(()=>{Me({id:a.id}).then(t=>{_this.$message("删除成功"),g()})})},x=C(null),M=()=>{if(!p.name)return x.value.focus(),!1;je(p).then(a=>{v.value=!1,g(),_this.$message("操作成功")}).catch(a=>{})},W=a=>{console.log(a),J(s.value,a.prompt_type_id||0,t=>{a.prompt_type_name=t.name}),T.isCheck&&o(a),N(),F.value=!1},J=(a,t,S)=>{a.forEach(Y=>{if(Y.id===t)return S&&S(Y),!0;Y.children&&Y.children.length>0&&J(Y.children,t,S)})};return(a,t)=>{const S=z("el-button"),Y=z("el-tree"),se=z("el-scrollbar"),pe=z("el-popover"),he=z("el-pagination"),be=z("el-input"),ve=z("el-form-item"),xe=z("el-form"),Te=z("el-drawer");return E(),q(ae,null,[l("div",{class:G([{component:T.proType||T.isCheck},"c-titlebox"])},[t[15]||(t[15]=l("span",{class:"title"},"提示词",-1)),m(S,{onClick:t[0]||(t[0]=_=>i()),type:"primary",size:"small"},{default:y(()=>t[14]||(t[14]=[P("新建")])),_:1})],2),l("div",{class:G(["c-bodybox",{component:T.proType||T.isCheck}])},[l("div",mt,[l("div",ft,[t[17]||(t[17]=l("span",{class:"title"},"提示词分类",-1)),m(S,{onClick:t[1]||(t[1]=_=>u({id:void 0})),class:"on noradius",plain:""},{default:y(()=>t[16]||(t[16]=[l("span",{class:"iconfont icon-anniu-zhankai"},null,-1),P(" 查看全部 ")])),_:1})]),l("div",gt,[m(se,null,{default:y(()=>[l("div",_t,[l("div",{class:G(["el-tree-node",{"is-current":k.prompt_type_id==0}])},[l("div",yt,[l("div",{onClick:t[2]||(t[2]=_=>u({id:0})),style:{"padding-left":"35px"},class:"custom-tree-node"},t[18]||(t[18]=[l("div",{class:"item"}," 未分类 ",-1)]))])],2)]),m(Y,{ref_key:"treeSelect",ref:r,style:{width:"100%"},data:s.value,"node-key":"id","empty-text":"暂无数据","highlight-current":"","current-node-key":k.prompt_type_id?parseInt(k.prompt_type_id):void 0,"default-expand-all":"",onNodeClick:u,"expand-on-click-node":!1},{default:y(({node:_,data:O})=>[l("div",{title:O.name,class:"custom-tree-node"},[l("div",bt,[l("p",vt,K(O.name),1)]),l("div",xt,[l("span",{title:"添加子类目",onClick:Z(me=>I(O,"child"),["stop"]),class:"iconfont icon-shuzhuang-tianjia"},null,8,Tt),l("span",{title:"修改",onClick:Z(me=>I(O),["stop"]),class:"iconfont icon-xiugai"},null,8,kt),l("span",{title:"删除类目",onClick:Z(me=>A(O),["stop"]),class:"iconfont icon-shuzhuang-shanchu"},null,8,Ct)])],8,ht)]),_:1},8,["data","current-node-key"])]),_:1})]),l("div",wt,[m(S,{style:{width:"100%"},plain:"",class:"on noradius",onClick:t[3]||(t[3]=_=>I({id:0}))},{default:y(()=>t[19]||(t[19]=[l("span",{class:"iconfont icon-liebiao-xinzeng"},null,-1),P(" 新增分类")])),_:1})])]),l("div",St,[m(se,{"max-height":le(D).getters.innerHeight-186,ref_key:"tableRef",ref:n},{default:y(()=>[l("div",$t,[l("div",Vt,[le(c).length<1?(E(),q("div",It,[m(Ae,{type:"empzwssjg",width:"100",height:"100"}),t[20]||(t[20]=P(" 该分类下暂无数据 "))])):ee("",!0),(E(!0),q(ae,null,_e(le(c),_=>(E(),q("div",{onClick:O=>o(_,a.index),class:G(["item c-pointer",{active:_.checked}]),key:_.id},[m(pe,{width:160},{reference:y(()=>t[21]||(t[21]=[l("span",{class:"iconfont icon-gengduo c-cardbtn-icon"},null,-1)])),default:y(()=>[l("div",{onClick:t[4]||(t[4]=Z(()=>{},["stop"])),class:"c-cardbtn-btns"},[l("div",{onClick:O=>i(_),class:"item"},t[22]||(t[22]=[l("span",{class:"name"},"修改",-1)]),8,Dt),l("div",{onClick:O=>f(_.id),class:"item"},t[23]||(t[23]=[l("span",{class:"name"},"删除",-1)]),8,Nt)])]),_:2},1024),l("div",Et,K(_.prompt_type_name),1),l("div",At,K(_.name),1),l("div",Mt,[_.content?(E(),ie(pe,{key:0,placement:"bottom",width:416,trigger:"hover"},{reference:y(()=>[l("div",Rt,[l("span",jt,K(_.content),1)])]),default:y(()=>[l("div",Lt,[m(se,{"max-height":"400"},{default:y(()=>[l("div",{innerHTML:_.content.replace(/\n/g,"<br>"),style:{margin:"0 20px"}},null,8,Pt)]),_:2},1024)])]),_:2},1024)):ee("",!0)])],10,zt))),128))])])]),_:1},8,["max-height"]),j.value>0?(E(),q("div",Ft,[m(he,{"hide-on-single-page":!1,background:"","page-size":k.pagesize,"current-page":k.page,onSizeChange:t[5]||(t[5]=_=>{k.pagesize=_,k.page=Math.min(Math.ceil(j.value/k.pagesize),k.page),N()}),onCurrentChange:t[6]||(t[6]=_=>{k.page=_,n.value&&n.value.scrollTo(0,0),N()}),"page-sizes":[36,50,100,1e3],layout:"total,sizes,jumper,prev, pager, next",total:j.value},null,8,["page-size","current-page","total"])])):ee("",!0)])],2),m(pt,{modelValue:F.value,"onUpdate:modelValue":t[7]||(t[7]=_=>F.value=_),onSubfn:W,curflowid:T.curflowid,curdataid:T.curdataid,nodeid:R.nodeid,nodes:R.nodes,edges:R.edges,item:e},null,8,["modelValue","curflowid","curdataid","nodeid","nodes","edges","item"]),m(Te,{modelValue:v.value,"onUpdate:modelValue":t[13]||(t[13]=_=>v.value=_),title:p.id?"修改分类":"新增分类",size:"600px"},{default:y(()=>[l("div",Bt,[m(xe,{ref:"formRef",style:{width:"100%"},model:p,onSubmit:t[9]||(t[9]=Z(()=>{},["prevent"])),onKeyup:t[10]||(t[10]=$e(Z(_=>M(),["prevent"]),["native","enter"])),"label-width":"auto",class:"demo-dynamic"},{default:y(()=>[m(ve,{prop:"name",label:" ",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},{default:y(()=>[m(be,{modelValue:p.name,"onUpdate:modelValue":t[8]||(t[8]=_=>p.name=_),ref_key:"inputRef",ref:x,placeholder:"分类名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),l("div",qt,[m(S,{plain:"",onClick:t[11]||(t[11]=_=>v.value=!1)},{default:y(()=>t[24]||(t[24]=[P(" 取消 ")])),_:1}),m(S,{type:"primary",onClick:t[12]||(t[12]=_=>M())},{default:y(()=>t[25]||(t[25]=[P(" 确定 ")])),_:1})])]),_:1},8,["modelValue","title"])],64)}}},Ut=ue(Ht,[["__scopeId","data-v-049d9291"]]),Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Ut},Symbol.toStringTag,{value:"Module"}));export{Ut as C,et as E,Xt as l,pt as t};
