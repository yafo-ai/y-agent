import{r as g,aR as se,h as ae,l as A,aS as oe,z as c,L as p,B as l,O as f,u as L,P as D,R as i,J as u,al as _,n as ne,A as r,I as q,W as O,Q as K,a6 as M,K as ie,S as de}from"./vue-CdYMfVVj.js";import{_ as re,a$ as ue,ad as ce,bh as pe,bi as _e,u as ve,i as P,bj as me,bk as he,bl as be}from"./index-B6WbZO8q.js";import{g as fe}from"./comp-ClzPtuSi.js";import"./editor.api-_A1huWdg.js";import"./list.vue_vue_type_style_index_1_lang-B8pmpZgU.js";/* empty css                                                              */import"./element-GwJlJi_X.js";import"./editor-Dhn2M38E.js";const ye={key:0,class:"dataset-detail"},ke={class:"c-titlebox"},ge={class:"title"},xe={class:"c-bodybox"},Ve={style:{width:"50%"},class:"catebox leftbox"},we={style:{height:"100%"},class:"treebox contain"},Ce=["title"],qe={class:"item"},Ue={class:"ellipsis"},$e={class:"btns"},ze={key:0,class:"tablebox rightbox"},De={class:"tableboxContain"},Se={class:"mg20"},Ie={key:0,class:"tipTitle"},Be={key:0,class:"err bold"},Te={key:1,class:"tipTitle"},je={class:"bold"},Ee={key:2,class:"tipTitle"},Fe={class:"bold"},Ge={class:"c-switchbox"},Re={class:"switch"},Ae={class:"c-switchbox"},Le={class:"switch"},Oe={class:"c-switchbox"},Ke={class:"switch"},Me={class:"searchbox"},Pe={class:"lbox"},Je={class:"itemsbox"},Ne={key:0,class:"items"},Qe={class:"label"},We={class:"vals"},He=["title","onClick"],Xe=["onClick"],Ye=["onClick"],Ze={key:1,class:"items"},et={style:{"justify-content":"flex-end"},class:"c-footerbtns"},tt={__name:"shop",setup(lt){const v=se(),S=oe();ve();const U=g(null),$=g([]),x=g(void 0);v.query.curid&&(x.value=parseInt(v.query.curid)),ue({id:v.query.id}).then(t=>{U.value=t,document.title=U.value.name}),ae(async()=>{F(x.value)});const J=t=>{o.attrs.push({id:0,attr_id:0,attr_key:"",attr_value:[""],attr_value_datatype:1,sort:0})},N=t=>{_this.$confirm("确定要删除该商品节点吗？").then(e=>{be({id:t}).then(a=>{if(_this.$message("删除成功"),m.value&&t==m.value.id){w({p_id:void 0});let d={...v.query,curid:void 0};S.replace({path:v.path,query:d})}V()})})},Q=A({knowledgebase_id:v.query.id,p_id:0,page:1,pagesize:1e4,keyword:""}),E=g(null),V=()=>{pe(Q).then(async t=>{t.rows.length<1&&w({}),$.value=[].concat(G(t.rows)),await ne(),E.value.setCurrentKey(parseInt(x.value))}).catch(t=>{})};V();const w=t=>{Object.assign(o,{...{id:void 0,p_id:0,name:"",caption:"",note:"",is_sku:!1,barcode:"",nccode:"",attrs:[]},...t})},W=t=>{F(t.id)},H=t=>{m.value={...t},he({p_id:t.id}).then(e=>{let a=e.parent_attrs;a.forEach(n=>{n.disabled=!0});let d=e.same_attrs;d.forEach(n=>{n.attr_value=[""]}),w({p_id:t.id,attrs:a.concat(d)})}).catch(e=>{w({p_id:t.id,attrs:[]})})},m=g(null),F=t=>{if(!t)return;let e={...v.query,curid:t};S.replace({path:v.path,query:e}),x.value=parseInt(t),ce({id:t}).then(a=>{a.parent_attrs&&(a.parent_attrs.forEach(d=>{d.disabled=!0}),a.product.attrs=a.parent_attrs.concat(a.product.attrs)),m.value=a.product,w(a.product)}).catch(a=>{})},o=A({knowledgebase_id:v.query.id,p_id:void 0,name:"",caption:"",note:"",is_sku:!1,barcode:"",nccode:"",attrs:[]});function I(t,e){for(let a=0;a<t.length;a++){if(t[a].id==e)return t[a];if(t[a].children&&t[a].children.length>0)return I(t[a].children,e)}return null}const X=(t,e,a,d)=>{if(!(!t||!e)&&t.data.id!=e.data.id&&e.data.p_id!=t.data.id){let n=I($.value,t.data.id);if(n&&n.children&&n.children.length>0&&I(n.children,e.data.id))return!1;t.data.p_id=e.data.id,me({id:t.data.id,target_pid:e.data.id}).then(h=>{V()}).catch(h=>{V()})}};function G(t,e=0){const a=[];for(let d=0;d<t.length;d++)if(t[d].p_id===e){const n=G(t,t[d].id);n.length&&(t[d].children=n),a.push(t[d])}return a.sort((d,n)=>d.is_sku===n.is_sku?d.id>n.id?1:-1:d.is_sku?1:-1),a}const R=g(),Y=t=>{t&&t.validate(e=>{if(e){let a=Object.assign({},o),d=[];a.attrs.forEach(n=>{n.id=n.id||0,n.attr_id=n.id,n.sort=n.sort||0,n.disabled||d.push(n)}),a.attrs=d,_e(a).then(n=>{_this.$message("提交成功"),o.id&&(m.value=o),V()}).catch(n=>{})}else return!1})},B=g(!1),Z=t=>B.value?!t.disabled:!0;return(t,e)=>{const a=_("el-button"),d=_("el-tree"),n=_("el-scrollbar"),h=_("el-input"),y=_("el-form-item"),T=_("el-switch"),ee=_("el-form"),te=_("el-checkbox"),z=_("el-option"),le=_("el-select");return U.value?(r(),c("div",ye,[l("div",ke,[l("span",ge,[l("span",{class:"c-pointer",style:{color:"#909BA5","margin-right":"5px"},onClick:e[0]||(e[0]=s=>L(fe)(null,L(S),"/dataset/list?active=2"))},e[11]||(e[11]=[f(" 全部知识库 "),l("span",{class:"iconfont icon-xiangyoujiantou"},null,-1)])),f(D(U.value.name),1)])]),l("div",xe,[l("div",Ve,[e[14]||(e[14]=l("div",{class:"topbtns"},[l("span",{class:"title"},"商品节点")],-1)),l("div",we,[i(n,null,{default:u(()=>[i(d,{ref_key:"treeSelect",ref:E,data:$.value,draggable:"",onNodeDragEnd:X,"node-key":"id","empty-text":"暂无商品节点信息","highlight-current":"","current-node-key":parseInt(x.value),"default-expand-all":"",onNodeClick:W,"expand-on-click-node":!1},{default:u(({node:s,data:b})=>[l("div",{title:b.name,class:"custom-tree-node"},[l("div",qe,[b.is_sku?(r(),q(P,{key:0,width:"18",height:"18",type:"spzsksp"})):(r(),q(P,{key:1,width:"18",height:"18",type:"spzskfl"})),l("div",Ue,D(b.name),1),l("div",$e,[b.is_sku?p("",!0):(r(),q(a,{key:0,onClick:O(k=>H(b),["stop"]),title:"添加子节点",size:"small",text:""},{default:u(()=>e[12]||(e[12]=[l("span",{class:"iconfont icon-shuzhuang-tianjia"},null,-1),f(" 添加 ")])),_:2},1032,["onClick"])),i(a,{style:{"margin-left":"0"},onClick:O(k=>N(b.id),["stop"]),title:"删除节点",type:"danger",size:"small",text:""},{default:u(()=>e[13]||(e[13]=[l("span",{class:"iconfont icon-shuzhuang-shanchu"},null,-1),f(" 删除 ")])),_:2},1032,["onClick"])])])],8,Ce)]),_:1},8,["data","current-node-key"])]),_:1})])]),o.p_id!==void 0?(r(),c("div",ze,[l("div",De,[i(n,null,{default:u(()=>[l("div",Se,[$.value.length<1?(r(),c("div",Ie,[o.p_id===0?(r(),c("span",Be," 还没有添加节点信息，请完善以下节点信息 ")):p("",!0)])):o.p_id&&!o.id?(r(),c("div",Te,[e[15]||(e[15]=f(" 在 ")),l("span",je,D(m.value&&m.value.name),1),e[16]||(e[16]=f(" 下添加节点 "))])):o.id?(r(),c("div",Ee,[l("span",Fe,D(m.value&&m.value.name),1)])):p("",!0),i(ee,{class:"tl",model:o,ref_key:"ruleForm",ref:R,"label-width":"auto","label-position":"top",inline:"",style:{width:"100%"}},{default:u(()=>[i(y,{style:{width:"calc(100% - 226px)","margin-right":"16px"},prop:"name",rules:[{required:!0,message:"请输入名称",trigger:"blur"}],label:"名称"},{default:u(()=>[i(h,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=s=>o.name=s),type:"text",placeholder:""},null,8,["modelValue"])]),_:1}),i(y,{class:"c-switchbox-label",style:{width:"210px","margin-right":"0"},label:"是否商品"},{default:u(()=>[l("div",Ge,[e[17]||(e[17]=l("div",{class:"label"},null,-1)),l("div",Re,[i(T,{modelValue:o.is_sku,"onUpdate:modelValue":e[2]||(e[2]=s=>o.is_sku=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),i(y,{class:"c-switchbox-label",style:{width:"calc(50% - 8px)","margin-right":"16px","margin-top":"-26px"},label:"是否停用"},{default:u(()=>[l("div",Ae,[e[18]||(e[18]=l("div",{class:"label"},null,-1)),l("div",Le,[i(T,{modelValue:o.is_disabled,"onUpdate:modelValue":e[3]||(e[3]=s=>o.is_disabled=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),i(y,{class:"c-switchbox-label",style:{width:"calc(50% - 8px)","margin-right":"0px","margin-top":"-26px"},label:"是否停产"},{default:u(()=>[l("div",Oe,[e[19]||(e[19]=l("div",{class:"label"},null,-1)),l("div",Ke,[i(T,{modelValue:o.is_stop_production,"onUpdate:modelValue":e[4]||(e[4]=s=>o.is_stop_production=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),o.is_sku?(r(),q(y,{key:0,style:{width:"calc(50% - 8px)","margin-right":"16px"},prop:"barcode",rules:[{required:!0,message:"请输入69码",trigger:"blur"}],label:"69码"},{default:u(()=>[i(h,{modelValue:o.barcode,"onUpdate:modelValue":e[5]||(e[5]=s=>o.barcode=s),type:"text",placeholder:""},null,8,["modelValue"])]),_:1})):p("",!0),o.is_sku?(r(),q(y,{key:1,style:{width:"calc(50% - 8px)","margin-right":"0px"},prop:"nccode",rules:[{required:!0,message:"请输入NC编码",trigger:"blur"}],label:"NC编码"},{default:u(()=>[i(h,{modelValue:o.nccode,"onUpdate:modelValue":e[6]||(e[6]=s=>o.nccode=s),type:"text",placeholder:""},null,8,["modelValue"])]),_:1})):p("",!0),i(y,{style:{width:"100%","margin-right":"0px"},label:"介绍"},{default:u(()=>[i(h,{modelValue:o.note,"onUpdate:modelValue":e[7]||(e[7]=s=>o.note=s),rows:2,type:"textarea",placeholder:"填写关于此产品的介绍，例如：名词是“华为D16系列”的介绍为：华为D16系列是华为笔记本D系列，其中16是指屏幕是16存大小，具有大屏特点，适合对需要大屏幕的用户，例如学生、视频图片编辑等用户。"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),l("div",Me,[l("div",Pe,[i(a,{onClick:e[8]||(e[8]=s=>J()),style:{"margin-right":"20px"},type:"primary"},{default:u(()=>e[20]||(e[20]=[f("添加属性")])),_:1}),i(te,{modelValue:B.value,"onUpdate:modelValue":e[9]||(e[9]=s=>B.value=s),label:"隐藏父级属性",size:"small"},null,8,["modelValue"])]),e[21]||(e[21]=l("div",{class:"rbox"},null,-1))]),l("div",Je,[e[26]||(e[26]=l("div",{class:"itemstitle"},[l("div",{class:"label"},"属性名"),l("div",{class:"vals"},"属性值")],-1)),o.attrs.length>0?(r(),c("div",Ne,[(r(!0),c(K,null,M(o.attrs,(s,b)=>ie((r(),c("div",{key:b,class:"item"},[l("div",Qe,[i(h,{disabled:s.disabled,modelValue:s.attr_key,"onUpdate:modelValue":k=>s.attr_key=k,placeholder:"属性名"},null,8,["disabled","modelValue","onUpdate:modelValue"]),i(le,{style:{width:"160px"},disabled:s.disabled,modelValue:s.attr_value_datatype,"onUpdate:modelValue":k=>s.attr_value_datatype=k,placeholder:"类型"},{default:u(()=>[i(z,{value:1,label:"字符串"}),i(z,{value:2,label:"数值"}),i(z,{value:3,label:"日期"}),i(z,{value:4,label:"列表"})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),l("div",We,[s.disabled?p("",!0):(r(),c("span",{key:0,title:"删除属性:"+s.attr_key,onClick:k=>o.attrs.splice(b,1),class:"addbtn c-danger-btn"},e[22]||(e[22]=[l("span",{class:"iconfont icon-liebiao-shanchu"},null,-1),f("删除 ")]),8,He)),(r(!0),c(K,null,M(s.attr_value,(k,C)=>(r(),c("div",{key:C,class:"val"},[i(h,{class:"inp",disabled:s.disabled,modelValue:s.attr_value[C],"onUpdate:modelValue":j=>s.attr_value[C]=j,placeholder:"属性值"},null,8,["disabled","modelValue","onUpdate:modelValue"]),s.attr_value.length>1&&!s.disabled?(r(),c("span",{key:0,style:{"margin-left":"10px"},class:"delbtn c-pointer",title:"删除当前属性值",onClick:j=>s.attr_value.splice(C,1)},e[23]||(e[23]=[l("span",{class:"iconfont icon-liebiao-shanchu"},null,-1)]),8,Xe)):p("",!0),s.attr_value.length==C+1&&!s.disabled?(r(),c("span",{key:1,title:"添加属性值",onClick:j=>s.attr_value.push(""),class:"addbtn1 c-pointer"},e[24]||(e[24]=[l("span",{class:"iconfont icon-xinzengcanshu"},null,-1)]),8,Ye)):p("",!0)]))),128))])])),[[de,Z(s)]])),128))])):(r(),c("div",Ze,e[25]||(e[25]=[l("div",{class:"empty"},"暂无属性数据",-1)])))])])]),_:1})]),l("div",et,[i(a,{onClick:e[10]||(e[10]=s=>Y(R.value)),type:"primary"},{default:u(()=>e[27]||(e[27]=[f("提交信息")])),_:1})])])):p("",!0)])])):p("",!0)}}},ct=re(tt,[["__scopeId","data-v-c535d2c3"]]);export{ct as default};
