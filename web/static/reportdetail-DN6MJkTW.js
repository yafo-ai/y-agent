import{_ as Q,c as Y,ax as G,u as K,ay as W,az as X,i as I}from"./index-B6WbZO8q.js";import{l as Z,r as _,aR as ee,z as c,B as a,R as s,L as g,O as n,u as o,aS as te,P as r,J as l,al as b,E as j,Q as E,A as d,a6 as ae,I as S}from"./vue-CdYMfVVj.js";import{g as N,a as D}from"./comp-ClzPtuSi.js";import{r as le,a as se}from"./result-CcYZ99eM.js";import"./element-GwJlJi_X.js";import"./editor-Dhn2M38E.js";const oe={class:"pagelistbox c-page-testplain-detail"},ne={key:0,class:"c-titlebox"},ie={class:"title"},re={class:"c-tablebox c-bodybox tableboxContain c-tooltip"},de={key:0,class:"mdbox"},ue={class:"historybox"},pe={class:"mg20"},_e={key:0,class:"c-emptybox"},ce=["onClick"],ge=["title"],me={class:"timebox"},ve={class:"time"},be={key:0,class:"tabbox"},fe={class:"c-primary-btn c-mini"},he={class:"c-primary-btn c-mini"},we={class:"c-primary-btn c-mini"},ye={class:"ellipsis2"},xe={style:{margin:"0 -20px"}},ke=["innerHTML"],Ce={class:"ellipsis2"},ze={style:{margin:"0 -20px"}},qe=["innerHTML"],Te={class:"ellipsis"},Ve={style:{margin:"0 -20px"}},Le=["innerHTML"],Me=["onClick"],Se=["onClick"],De={class:"c-emptybox"},He={key:1,style:{"padding-right":"18px"},class:"c-pagination"},Be={__name:"reportdetail",setup(Re){const p=ee(),k=te(),A=K();let i=Z({id:0,page:1,pagesize:30,test_result:0});const x=_(0);Y(i,p.query);let C=_([]);const w=u=>{if(u=="init"&&(i.page=1),i.id=y.value,X(i).then(e=>{let h=e.rows||[];C.value=h,x.value=e.total_records}),u!="noquery"){let e={...p.query,...i};k.replace({path:p.path,query:e})}},y=_(""),f=_([]),m=_(null),z=u=>{u&&(y.value=u.report_id),m.value=null,C.value=[],W({id:y.value}).then(e=>{m.value=e,w("noquery")})};p.path=="/testplan/detail"?G({id:p.query.id}).then(u=>{f.value=u||[],z(f.value[0])}):(y.value=p.query.id,z());const q=_(null),P=()=>{w("init")},H=_({}),T=_(!1),B=(u,e)=>{if(!u)return!1;H.value={id:u},T.value=!0},V=_(!1),R=_({}),U=u=>{_this.$message("操作成功"),w(),V.value=!1};return(u,e)=>{const h=b("el-scrollbar"),L=b("el-tab-pane"),F=b("el-tabs"),v=b("el-table-column"),M=b("el-popover"),J=b("el-table"),O=b("el-pagination");return d(),c(E,null,[a("div",oe,[m.value?(d(),c("div",ne,[a("span",ie,[a("span",{class:"c-pointer",style:{color:"#909BA5","margin-right":"5px"},onClick:e[0]||(e[0]=t=>o(N)(null,o(k),o(p).query.fpath||(o(p).path=="/testplan/detail"?"/testplan":"/testreport")))},[n(r(o(p).path=="/testplan/detail"?"测试计划":"测试报告")+" ",1),e[7]||(e[7]=a("span",{class:"iconfont icon-xiangyoujiantou"},null,-1))]),n(r(m.value.plan_name),1)])])):g("",!0),a("div",re,[f.value.length>0?(d(),c("div",de,[e[9]||(e[9]=a("div",{class:"title"},"报告历史记录",-1)),a("div",ue,[s(h,null,{default:l(()=>[a("div",pe,[f.value.length<1?(d(),c("div",_e,[s(I,{type:"empzwssjg",width:"40",height:"40"}),e[8]||(e[8]=n(" 暂无历史记录 "))])):g("",!0),(d(!0),c(E,null,ae(f.value,t=>(d(),c("div",{onClick:$=>z(t),key:t.report_id,class:j([{on:t.report_id==y.value},"item"])},[a("div",{title:t.name,class:"name ellipsis3"},r(t.name),9,ge),a("div",me,[a("span",ve,r(o(D)(t.created_at)),1)])],10,ce))),128))])]),_:1})])])):g("",!0),a("div",{class:j(["bodybox",{on:f.value.length>0}])},[m.value?(d(),c("div",be,[s(F,{modelValue:o(i).test_result,"onUpdate:modelValue":e[1]||(e[1]=t=>o(i).test_result=t),class:"demo-tabs",onTabChange:P},{default:l(()=>[s(L,{name:0},{label:l(()=>[e[10]||(e[10]=n(" 已运行用例 ")),a("span",fe,r(parseInt(m.value.test_fail_count)+parseInt(m.value.test_pass_count)),1)]),_:1}),s(L,{name:3001},{label:l(()=>[e[11]||(e[11]=n(" 未通过 ")),a("span",he,r(m.value.test_fail_count),1)]),_:1}),s(L,{name:2001},{label:l(()=>[e[12]||(e[12]=n(" 已通过")),a("span",we,r(m.value.test_pass_count),1)]),_:1})]),_:1},8,["modelValue"]),a("span",{style:{position:"absolute",top:"5px",right:"10px","z-index":"11"},onClick:e[2]||(e[2]=t=>o(N)(null,o(k),o(p).query.fpath||(o(p).path=="/testplan/detail"?"/testplan":"/testreport"))),class:"c-iconbackbox"},e[13]||(e[13]=[a("span",{class:"iconfont icon-fuwenben-chexiao"},null,-1),n(" 返回 ")]))])):g("",!0),s(J,{ref_key:"tableRef",ref:q,"max-height":o(A).getters.innerHeight-203,"tooltip-effect":"light",border:"",data:o(C),style:{width:"100%"}},{empty:l(t=>[a("div",De,[s(I,{type:"empzwssjg",width:"100",height:"100"}),e[19]||(e[19]=n("暂无数据~~ "))])]),default:l(()=>[s(v,{prop:"id",width:"70",label:"id"}),s(v,{label:"问题"},{default:l(t=>[t.row.question?(d(),S(M,{key:0,placement:"top-start",width:1e3,trigger:"hover"},{reference:l(()=>[a("div",ye,[e[14]||(e[14]=a("span",{class:"c-primary-btn c-mini"},"问",-1)),n(" "+r(t.row.question),1)])]),default:l(()=>[a("div",xe,[s(h,{"max-height":"400"},{default:l(()=>[a("div",{innerHTML:t.row.question.replace(/\n/g,"<br>"),style:{margin:"0 20px"}},null,8,ke)]),_:2},1024)])]),_:2},1024)):g("",!0)]),_:1}),s(v,{label:"参考结果"},{default:l(t=>[t.row.right_answer?(d(),S(M,{key:0,placement:"top-start",width:800,trigger:"hover"},{reference:l(()=>[a("div",Ce,[e[15]||(e[15]=a("span",{class:"c-success-btn c-mini"},"参",-1)),n(" "+r(t.row.right_answer),1)])]),default:l(()=>[a("div",ze,[s(h,{"max-height":"400"},{default:l(()=>[a("div",{innerHTML:t.row.right_answer.replace(/\n/g,"<br>"),style:{margin:"0 20px"}},null,8,qe)]),_:2},1024)])]),_:2},1024)):g("",!0)]),_:1}),s(v,{label:"测试结果"},{default:l(t=>[t.row.test_answer?(d(),S(M,{key:0,placement:"top-start",width:600,trigger:"hover"},{reference:l(()=>[a("div",Te,[e[16]||(e[16]=a("span",{class:"c-warn-btn c-mini"},"测",-1)),n(" "+r(t.row.test_answer),1)])]),default:l(()=>[a("div",Ve,[s(h,{"max-height":"400"},{default:l(()=>[a("div",{innerHTML:t.row.test_answer.replace(/\n/g,"<br>"),style:{margin:"0 20px"}},null,8,Le)]),_:2},1024)])]),_:2},1024)):g("",!0)]),_:1}),s(v,{width:"120",label:"模型名称"},{default:l(t=>[n(r(t.row.execute_llm_name||t.row.execute_workflow_name),1)]),_:1}),s(v,{width:"80",align:"right",label:"评分"},{default:l(t=>[n(r(t.row.score),1)]),_:1}),s(v,{width:"80",align:"right",label:"耗时"},{default:l(t=>[n(r(t.row.elapsed_time),1)]),_:1}),s(v,{width:"160",align:"center",label:"执行时间"},{default:l(t=>[n(r(o(D)(t.row.updated_at)||o(D)(t.row.created_at)),1)]),_:1}),s(v,{width:"160",align:"right",label:"操作"},{default:l(t=>[t.row.workflow_log_id?(d(),c("div",{key:0,onClick:$=>B(t.row.workflow_log_id,1),class:"c-table-ibtn"},e[17]||(e[17]=[a("span",{class:"iconfont icon-liebiao-ceshi"},null,-1),n(" 测试详情 ")]),8,Me)):g("",!0),t.row.testcase_workflow_log_id?(d(),c("div",{key:1,onClick:$=>B(t.row.testcase_workflow_log_id,2),class:"c-table-ibtn"},e[18]||(e[18]=[a("span",{class:"iconfont icon-liebiao-xiangqing"},null,-1),n(" 用例详情 ")]),8,Se)):g("",!0)]),_:1})]),_:1},8,["max-height","data"]),x.value>0?(d(),c("div",He,[s(O,{"hide-on-single-page":!1,background:"","page-size":o(i).pagesize,"current-page":o(i).page,onSizeChange:e[3]||(e[3]=t=>{o(i).pagesize=t,o(i).page=Math.min(Math.ceil(x.value/o(i).pagesize),o(i).page),w()}),onCurrentChange:e[4]||(e[4]=t=>{o(i).page=t,q.value&&q.value.scrollTo(0,0),w()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:x.value},null,8,["page-size","current-page","total"])])):g("",!0)],2)])]),s(le,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=t=>T.value=t),data:H.value},null,8,["modelValue","data"]),s(se,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),TEST_TYPE:"S",item:R.value,title:R.value.id?"修改单元测试":"添加单元测试",onSubfn:U},null,8,["modelValue","item","title"])],64)}}},Pe=Q(Be,[["__scopeId","data-v-66ef2b07"]]);export{Pe as default};
