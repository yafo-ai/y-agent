import{r as c,aR as Ce,l as J,z as v,B as t,R as n,J as i,al as u,u as x,L as I,Q as j,aS as Ve,n as $e,A as f,O as r,E as te,P as C,W as b,a6 as D,I as ze,a4 as qe}from"./vue-CdYMfVVj.js";import{_ as Ue,u as Se,H as Re,I as Ae,i as Te,d as Ie,J as je,K as Fe,L as Ne,M as Be,N as Le,O as Ee}from"./index-B6WbZO8q.js";import{v as We}from"./v4-D8aEg3BZ.js";import"./element-GwJlJi_X.js";import"./editor-Dhn2M38E.js";const Ke={class:"c-titlebox"},Me={class:"btns"},Oe={class:"c-bodybox"},Je={class:"catebox leftbox"},De={class:"topbtns"},He={class:"contain"},Pe={class:"el-tree el-tree--highlight-current",role:"tree",style:{width:"100%"}},Qe={class:"el-tree-node__content"},Ze=["title"],Ge={class:"item"},Xe={class:"ellipsis"},Ye={class:"btns"},et=["onClick"],tt=["onClick"],lt=["onClick"],st={class:"botbtns"},ot={style:{height:"auto"},class:"scrollbox rightbox"},nt={class:"contain"},it={key:0,class:"c-emptybox"},at={class:"pagelistbox"},dt=["onClick"],rt={class:"topbox"},ut={key:0,class:"iconbtn re tool"},pt={key:1,class:"iconbtn re"},ct={class:"c-cardbtn-btns"},ft=["onClick"],mt=["onClick"],_t=["onClick"],vt=["onClick"],gt=["title"],yt=["title"],kt={key:0,class:"ellipsis labelbox"},ht={class:"sourcesbox"},bt={class:"item"},wt={class:"name"},xt={class:"api_key"},Ct={key:0,style:{"padding-right":"24px"},class:"c-pagination"},Vt={class:"dialogFormVisible1box"},$t={class:"formbox"},zt={class:"c-switchbox"},qt={class:"switch"},Ut={class:"c-switchbox"},St={class:"switch"},Rt={class:"c-switchbox"},At={class:"switch"},Tt={class:"tagsbox"},It={class:"item"},jt={class:"name"},Ft={class:"api_key"},Nt={class:"opt"},Bt=["onClick"],Lt={class:"dialog-footer"},Et={class:"formbox"},Wt={class:"dialog-footer"},Kt={__name:"list",props:{proType:{type:[String,Number],default:()=>""},isCheck:{type:[Boolean],default:()=>!1},checkList:{type:[Array],default:()=>[]}},emits:["subfn"],setup(le,{emit:Mt}){const g=Ce(),H=Ve(),y=c(void 0),se=le,V=Se(),$=c(!1);let F=c([]);const z=c(0),w=c(1),q=c(36);g.query.page&&(w.value=parseInt(g.query.page)),g.query.pagesize&&(q.value=parseInt(g.query.pagesize)),g.query.category_id&&(y.value=parseInt(g.query.category_id));const k=l=>{let e={page:w.value,pagesize:q.value,category_id:y.value};if(l=="init"&&(e.page=1),Re(e).then(a=>{let m=a.rows||[];se.proType?(m=a||[],z.value=0):z.value=a.total_records,F.value=m}),l!="noquery"){let a={...g.query,...e};H.replace({path:g.path,query:a})}};k("noquery");const oe=l=>{H.push({path:"/flow",query:{id:l.id,api_key:l.api_key}})},P=async l=>{if(ne(),l){let e=await Ee({id:l.id});ie(e)}$.value=!0,ae()},ne=()=>{o.id=0,o.name="",o.category_id=y.value,o.category_name="",o.is_tool=!1,o.use_log=!0,o.sources=[],o.is_share=!1,o.api_key=void 0,o.caption="",o.view_json=""},ie=l=>{o.id=l.id,o.name=l.name,o.category_id=l.category_id,o.category_name=l.category_name,o.is_share=l.is_share,o.api_key=l.api_key,o.sources=l.sources||[],o.is_tool=l.is_tool,o.use_log=l.use_log===void 0?!0:l.use_log,o.caption=l.caption,o.view_json=l.view_json},ae=()=>{setTimeout(()=>{const l=document.querySelector(".autofocus.inp2 input");l&&l.focus()},100)},de=l=>{_this.$confirm("此操作将永久删除该工作流, 是否继续?").then(e=>{Fe({id:l}).then(a=>{_this.$message("删除成功"),k()})})},o=J({name:"",content:"",category_id:void 0,category_name:"",is_tool:!1,is_share:!1,use_log:!0,api_key:void 0,sources:[],id:0,view_json:""}),Q=c(),re=J({name:[{required:!0,message:"请输入流程图名称"}]}),ue=async l=>{l&&l.validate(e=>{if(e)o.category_id=o.category_id||0,X(T.value,o.category_id,a=>{o.category_name=a.name}),Be(o,"baseinfo").then(a=>{a&&(_this.$message("提交成功"),$.value=!1,k())});else return document.querySelectorAll(".autofocus.inp2 input")[0].focus(),!1})},pe=(l,e)=>{if(!l.is_share){_this.$message("此流程不支持分享，请先设置后再进行操作！","error");return}let a=l.id,m=e||"";_this.$copy(window.location.href.split("/flowlist")[0]+"/flowshare?id="+a+"&api_key="+m)},N=c(null),ce=l=>{Ne({flow_id:l.id}).then(e=>{_this.$message("复制成功"),k()})},U=c(null),fe=(l,e,a)=>{console.log(l,e,a),V.commit("loading",!1),_this.$message("上传成功"),k(),A.value=[],U.value&&U.value.clearFiles()},me=l=>{V.commit("loading",!1);let e=l.toString();e=e.replace("UploadAjaxError: ",""),e=JSON.parse(e),_this.$message(e.detail,"error"),U.value&&U.value.clearFiles()},A=c([]),_e=(l,e)=>{console.log(l,e),A.value=e},ve=l=>(V.commit("loading",!0),!0),T=c([]),Z=c(null),B=async l=>{y.value=l.id,k("init")},L=l=>{Ae().then(async e=>{T.value=e||[],await $e(),Z.value.setCurrentKey(parseInt(y.value))}).catch(e=>{})};L();const S=c(!1),p=J({name:"",id:0,note:"",pid:0}),E=async(l,e)=>{p.pid=l.pid||0,p.id=l.id||0,p.name=l.name||"",p.note=l.note||"",e=="child"&&(p.pid=l.id,p.name="",p.note="",p.id=void 0),S.value=!0,setTimeout(()=>{W.value.focus()},500)},ge=l=>{_this.$confirm("确定要删除所选数据?").then(()=>{je({id:l.id}).then(e=>{_this.$message("删除成功"),L()})})},W=c(null),G=()=>{if(!p.name)return W.value.focus(),!1;Le(p).then(l=>{S.value=!1,L(),_this.$message("操作成功")}).catch(l=>{})},X=(l,e,a)=>{l.forEach(m=>{if(m.id===e)return a&&a(m),!0;m.children&&m.children.length>0&&X(m.children,e,a)})};return(l,e)=>{const a=u("el-button"),m=u("el-upload"),ye=u("el-tree"),K=u("el-scrollbar"),Y=u("el-popover"),ke=u("el-link"),he=u("el-pagination"),R=u("el-input"),h=u("el-form-item"),be=u("el-tree-select"),M=u("el-tooltip"),O=u("el-switch"),ee=u("el-form"),we=u("el-dialog"),xe=u("el-drawer");return f(),v(j,null,[t("div",Ke,[e[26]||(e[26]=t("span",{class:"title"},"流程图",-1)),t("div",Me,[n(a,{style:{"margin-right":"16px"},size:"small",onClick:e[0]||(e[0]=s=>P()),type:"primary"},{default:i(()=>e[24]||(e[24]=[r("新建")])),_:1}),n(m,{style:{width:"100%"},class:"upload-demo",ref_key:"upload",ref:U,"file-list":A.value,"onUpdate:fileList":e[1]||(e[1]=s=>A.value=s),"show-file-list":!1,headers:{authorization:"Bearer "+x(V).state.token},"before-upload":ve,"on-change":_e,"on-error":me,"on-success":fe,action:"/api/workflow/import"},{default:i(()=>[n(a,{size:"small",plain:""},{default:i(()=>e[25]||(e[25]=[r("导入流程")])),_:1})]),_:1},8,["file-list","headers"])])]),t("div",Oe,[t("div",Je,[t("div",De,[e[28]||(e[28]=t("span",{class:"title"},"流程图分类",-1)),n(a,{onClick:e[2]||(e[2]=s=>B({id:void 0})),class:"on noradius",plain:""},{default:i(()=>e[27]||(e[27]=[t("span",{class:"iconfont icon-anniu-zhankai"},null,-1),r(" 查看全部 ")])),_:1})]),t("div",He,[n(K,null,{default:i(()=>[t("div",Pe,[t("div",{class:te(["el-tree-node",{"is-current":y.value==0}])},[t("div",Qe,[t("div",{onClick:e[3]||(e[3]=s=>B({id:0})),style:{"padding-left":"35px"},class:"custom-tree-node"},e[29]||(e[29]=[t("div",{class:"item"}," 未分类 ",-1)]))])],2)]),n(ye,{ref_key:"treeSelect",ref:Z,style:{width:"100%"},data:T.value,"node-key":"id","empty-text":"暂无数据","highlight-current":"","current-node-key":y.value?parseInt(y.value):void 0,"default-expand-all":"",onNodeClick:B,"expand-on-click-node":!1},{default:i(({node:s,data:_})=>[t("div",{title:_.name,class:"custom-tree-node"},[t("div",Ge,[t("p",Xe,C(_.name),1)]),t("div",Ye,[t("span",{title:"添加子类目",onClick:b(d=>E(_,"child"),["stop"]),class:"iconfont icon-shuzhuang-tianjia"},null,8,et),t("span",{title:"修改",onClick:b(d=>E(_),["stop"]),class:"iconfont icon-xiugai"},null,8,tt),t("span",{title:"删除类目",onClick:b(d=>ge(_),["stop"]),class:"iconfont icon-shuzhuang-shanchu"},null,8,lt)])],8,Ze)]),_:1},8,["data","current-node-key"])]),_:1})]),t("div",st,[n(a,{style:{width:"100%"},plain:"",class:"on noradius",onClick:e[4]||(e[4]=s=>E({id:0}))},{default:i(()=>e[30]||(e[30]=[t("span",{class:"iconfont icon-liebiao-xinzeng"},null,-1),r(" 新增分类")])),_:1})])]),t("div",ot,[n(K,{"max-height":x(V).getters.innerHeight-186,ref_key:"tableRef",ref:N},{default:i(()=>[t("div",nt,[x(F).length<1?(f(),v("div",it,[n(Te,{type:"empzwssjg",width:"100",height:"100"}),e[31]||(e[31]=r(" 该分类下暂无数据 "))])):I("",!0),t("div",at,[(f(!0),v(j,null,D(x(F),(s,_)=>(f(),v("div",{onClick:d=>oe(s,_),key:_,class:te(["item",{active:s.checked,["id"+s.id]:!0}])},[e[40]||(e[40]=t("span",{class:"iconfont icon-liuchengtu-kapianzaiti"},null,-1)),t("div",rt,[s.is_tool?(f(),v("div",ut)):(f(),v("div",pt)),t("div",{onClick:e[5]||(e[5]=b(()=>{},["stop"])),class:"rbox"},[n(Y,{width:160},{reference:i(()=>e[32]||(e[32]=[t("span",{class:"iconfont icon-gengduo c-cardbtn-icon"},null,-1)])),default:i(()=>[t("div",ct,[t("div",{onClick:d=>P(s),class:"item"},e[33]||(e[33]=[t("span",{class:"name"},"设置",-1)]),8,ft),t("div",{onClick:d=>de(s.id),class:"item err"},e[34]||(e[34]=[t("span",{class:"name"},"删除",-1)]),8,mt),t("div",{title:"创建一个流程图副本",onClick:d=>ce(s),class:"item"},e[35]||(e[35]=[t("span",{class:"name"},"创建副本",-1)]),8,_t),t("div",{title:"导出文件",onClick:d=>x(Ie)("/api/workflow/export/"+s.id),class:"item"},e[36]||(e[36]=[t("span",{class:"name"},"导出文件",-1)]),8,vt)])]),_:2},1024)])]),t("div",{title:s.name,class:"namebox re ellipsis"},C(s.name),9,gt),t("div",{title:s.caption||"这个流程图还没有介绍~",class:"introbox re ellipsis2"},C(s.caption||"这个流程图还没有介绍~"),9,yt),e[41]||(e[41]=t("div",{class:"sharebtn"}," 编辑 ",-1)),s?(f(),v("div",kt,[s.sources&&s.sources.length>0?(f(),ze(Y,{key:0,placement:"bottom-start","popper-style":{width:"auto",padding:"10px",minWidth:"80px",maxWidth:"600px"}},{reference:i(()=>e[37]||(e[37]=[t("div",{class:"ellipsis"}," 分享 ",-1)])),default:i(()=>[t("div",ht,[(f(!0),v(j,null,D(s.sources,d=>(f(),v("div",bt,[t("div",wt,[t("span",null,"名称："+C(d.source_name),1),e[39]||(e[39]=r()),n(ke,{onClick:b(Ot=>pe(s,d.api_key),["stop"])},{default:i(()=>e[38]||(e[38]=[r("分享")])),_:2},1032,["onClick"])]),t("div",xt,"api_key："+C(d.api_key),1)]))),256))])]),_:2},1024)):I("",!0)])):I("",!0)],10,dt))),128))])])]),_:1},8,["max-height"]),z.value>0?(f(),v("div",Ct,[n(he,{"hide-on-single-page":!1,background:"","page-size":q.value,"current-page":w.value,onSizeChange:e[6]||(e[6]=s=>{q.value=s,w.value=Math.min(Math.ceil(z.value/q.value),w.value),k()}),onCurrentChange:e[7]||(e[7]=s=>{w.value=s,N.value&&N.value.scrollTo(0,0),k()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:z.value},null,8,["page-size","current-page","total"])])):I("",!0)])]),n(we,{"align-center":"",modelValue:$.value,"onUpdate:modelValue":e[17]||(e[17]=s=>$.value=s),title:o.id?"设置流程图":"创建流程图",width:"900"},{footer:i(()=>[t("div",Lt,[n(a,{onClick:e[15]||(e[15]=s=>$.value=!1),plain:""},{default:i(()=>e[54]||(e[54]=[r("取消")])),_:1}),n(a,{type:"primary",onClick:e[16]||(e[16]=s=>ue(Q.value))},{default:i(()=>e[55]||(e[55]=[r(" 提交 ")])),_:1})])]),default:i(()=>[t("div",Vt,[n(K,null,{default:i(()=>[t("div",$t,[n(ee,{ref_key:"ruleFormRef1",ref:Q,rules:re,"label-width":l.auto,"label-position":"top",inline:"",model:o},{default:i(()=>[n(h,{style:{width:"calc(100% - 316px)","margin-right":"16px"},label:"流程图名称",prop:"name"},{default:i(()=>[n(R,{class:"autofocus inp2",placeholder:"请输入流程图名称",modelValue:o.name,"onUpdate:modelValue":e[8]||(e[8]=s=>o.name=s),maxlength:"50",autocomplete:"off"},null,8,["modelValue"])]),_:1}),n(h,{label:"流程图类型",style:{width:"300px","margin-right":"0"},prop:"prompt_type_id"},{default:i(()=>[n(be,{modelValue:o.category_id,"onUpdate:modelValue":e[9]||(e[9]=s=>o.category_id=s),filterable:"","check-strictly":"","node-key":"id",props:{children:"children",label:"name",value:"id"},"default-expand-all":!0,"check-on-click-node":!0,data:[{id:0,name:"未分类",pid:null,children:[]}].concat(T.value),style:{width:"100%"}},{default:i(({node:s,data:_})=>[t("span",null,C(_.name),1)]),_:1},8,["modelValue","data"])]),_:1}),n(h,{class:"c-switchbox-label",style:{width:"calc(33% - 16px)","margin-right":"16px","margin-top":"-26px"},label:"",prop:"is_tool"},{label:i(()=>[e[43]||(e[43]=r("是否工具 ")),n(M,{"popper-class":"c-flowtip",class:"item",effect:"dark",content:"开启后，可以在流程编辑页面，将此流程作为工具使用",placement:"top"},{default:i(()=>e[42]||(e[42]=[t("span",{style:{position:"relative",top:"1px"},class:"iconfont icon-bangzhu"},null,-1)])),_:1})]),default:i(()=>[t("div",zt,[e[44]||(e[44]=t("div",{class:"label"},null,-1)),t("div",qt,[n(O,{modelValue:o.is_tool,"onUpdate:modelValue":e[10]||(e[10]=s=>o.is_tool=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),n(h,{class:"c-switchbox-label",style:{width:"calc(33% - 16px)","margin-right":"16px","margin-top":"-26px"},label:"",prop:"use_log"},{label:i(()=>[e[46]||(e[46]=r("是否启用日志 ")),n(M,{"popper-class":"c-flowtip",class:"item",effect:"dark","raw-content":"",content:"开启后，系统默认会记录此流程的运行日志 <br /> 注意:此开关仅作为默认设置，当通过WebApi调用此流程的时候，可以单独指定是否启用日志",placement:"top"},{default:i(()=>e[45]||(e[45]=[t("span",{style:{position:"relative",top:"1px"},class:"iconfont icon-bangzhu"},null,-1)])),_:1})]),default:i(()=>[t("div",Ut,[e[47]||(e[47]=t("div",{class:"label"},null,-1)),t("div",St,[n(O,{modelValue:o.use_log,"onUpdate:modelValue":e[11]||(e[11]=s=>o.use_log=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),n(h,{class:"c-switchbox-label",style:{width:"calc(34% - 0px)","margin-right":"0","margin-top":"-26px"},label:"",prop:"is_share"},{label:i(()=>[e[49]||(e[49]=r("是否允许分享 ")),n(M,{"popper-class":"c-flowtip",class:"item",effect:"dark","raw-content":"",content:"允许外部进行 网页访问 和 WebApi调用",placement:"top"},{default:i(()=>e[48]||(e[48]=[t("span",{style:{position:"relative",top:"1px"},class:"iconfont icon-bangzhu"},null,-1)])),_:1})]),default:i(()=>[t("div",Rt,[e[50]||(e[50]=t("div",{class:"label"},null,-1)),t("div",At,[n(O,{modelValue:o.is_share,"onUpdate:modelValue":e[12]||(e[12]=s=>o.is_share=s),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])])]),_:1}),n(h,{style:{width:"100%","margin-right":"0",position:"relative"},label:"api_key",prop:"caption"},{label:i(()=>[e[52]||(e[52]=r("分享设置 ")),n(a,{style:{position:"absolute",right:"0",top:"0"},onClick:e[13]||(e[13]=s=>o.sources.push({source_id:0,source_name:"",api_key:x(We)()})),size:"small",type:"primary"},{default:i(()=>e[51]||(e[51]=[r("新增")])),_:1})]),default:i(()=>[t("div",Tt,[e[53]||(e[53]=t("div",{class:"item title"},[t("div",{class:"name"},"名称"),t("div",{class:"api_key"},"api_key"),t("div",{class:"opt"})],-1)),(f(!0),v(j,null,D(o.sources,(s,_)=>(f(),v("div",It,[t("div",jt,[n(R,{style:{width:"100%"},modelValue:s.source_name,"onUpdate:modelValue":d=>s.source_name=d,placeholder:"标签名称"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ft,[n(R,{modelValue:s.api_key,"onUpdate:modelValue":d=>s.api_key=d,placeholder:"api_key"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Nt,[t("span",{onClick:d=>o.sources.splice(_,1),class:"iconfont icon-liebiao-shanchu"},null,8,Bt)])]))),256))])]),_:1}),n(h,{style:{width:"100%","margin-right":"0"},label:"流程图介绍",prop:"caption"},{default:i(()=>[n(R,{modelValue:o.caption,"onUpdate:modelValue":e[14]||(e[14]=s=>o.caption=s),rows:10,type:"textarea",placeholder:"这个流程图还没有介绍~"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","label-width","model"])])]),_:1})])]),_:1},8,["modelValue","title"]),n(xe,{modelValue:S.value,"onUpdate:modelValue":e[23]||(e[23]=s=>S.value=s),title:p.id?"修改分类":"新增分类",size:"600px"},{default:i(()=>[t("div",Et,[n(ee,{ref:"formRef",style:{width:"100%"},model:p,onSubmit:e[19]||(e[19]=b(()=>{},["prevent"])),onKeyup:e[20]||(e[20]=qe(b(s=>G(),["prevent"]),["native","enter"])),"label-width":"auto",class:"demo-dynamic"},{default:i(()=>[n(h,{prop:"name",label:" ",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},{default:i(()=>[n(R,{modelValue:p.name,"onUpdate:modelValue":e[18]||(e[18]=s=>p.name=s),ref_key:"inputRef",ref:W,placeholder:"分类名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("div",Wt,[n(a,{plain:"",onClick:e[21]||(e[21]=s=>S.value=!1)},{default:i(()=>e[56]||(e[56]=[r(" 取消 ")])),_:1}),n(a,{type:"primary",onClick:e[22]||(e[22]=s=>G())},{default:i(()=>e[57]||(e[57]=[r(" 确定 ")])),_:1})])]),_:1},8,["modelValue","title"])],64)}}},Zt=Ue(Kt,[["__scopeId","data-v-caa8ac36"]]);export{Zt as default};
